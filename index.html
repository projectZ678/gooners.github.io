<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gooning Hub Leaderboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet"/>
  <style>
    :root{
      --bg:#050505;--glass:#111111ee;--glass-border:rgba(255,255,255,.08);
      --text:#f5f5f5;--muted:#aaa;--accent:#fff;--discord:#ccc;
      --goon:#ff4d8c;--gold:#ffd700;--silver:#c0c0c0;--bronze:#cd7f32;
      font-family:'Inter',system-ui,sans-serif;
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;outline:none;
      user-select:none;-webkit-tap-highlight-color:transparent;}
    html,body{min-height:100vh;background:var(--bg);overflow:hidden;color:var(--text);
      display:flex;justify-content:center;align-items:flex-start;touch-action:manipulation;}
    .stars{position:fixed;inset:0;pointer-events:none;z-index:0;}
    .star{position:absolute;background:#fff;border-radius:50%;opacity:0;animation:fall linear infinite;}
    @keyframes fall{0%{transform:translateY(-100px) scale(.2);opacity:0;}
      10%{opacity:1;}90%{opacity:.3;}100%{transform:translateY(100vh) scale(.8);opacity:0;}}
    #app{width:100vw;height:100vh;position:relative;z-index:1;backdrop-filter:blur(24px);
      background:var(--glass);padding:32px 48px;display:flex;flex-direction:column;overflow:hidden;}
    h1{font-weight:800;font-size:3.2rem;letter-spacing:4px;background:linear-gradient(90deg,#fff,#eee);
      -webkit-background-clip:text;background-clip:text;color:transparent;text-shadow:0 0 50px rgba(255,255,255,.5);
      margin-bottom:28px;animation:titleGlow 3s ease-in-out infinite alternate;text-align:center;}
    @keyframes titleGlow{from{text-shadow:0 0 30px var(--accent);}to{text-shadow:0 0 60px var(--accent),0 0 120px var(--accent);}}
    .table-container{flex:1;overflow-y:auto;border-radius:20px;
      border:1px solid var(--glass-border);background:rgba(0,0,0,.28);box-shadow:inset 0 10px 18px rgba(0,0,0,.5);
      scrollbar-width:thin;scrollbar-color:#555 transparent;}
    .table-container::-webkit-scrollbar{width:12px;}
    .table-container::-webkit-scrollbar-track{background:transparent;}
    .table-container::-webkit-scrollbar-thumb{background:#555;border-radius:6px;border:3px solid transparent;background-clip:content-box;}
    .table-container::-webkit-scrollbar-thumb:hover{background:#777;}
    table{width:100%;border-collapse:collapse;}
    thead{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,rgba(30,30,30,.98),rgba(20,20,20,.95));
      backdrop-filter:blur(16px);text-transform:uppercase;font-size:.92rem;letter-spacing:2.4px;color:var(--muted);
      border-bottom:1px solid var(--glass-border);}
    th,td{padding:26px 30px;transition:.3s;}
    tr:hover{background:rgba(255,255,255,.12);transform:translateX(12px);box-shadow:0 14px 28px rgba(255,255,255,.15);}
    .rank{font-weight:800;color:var(--accent);font-size:1.9rem;text-align:center;text-shadow:0 0 20px rgba(255,255,255,.6);}
    .rank:nth-of-type(1){color:var(--gold);font-size:2.1rem;text-shadow:0 0 35px var(--gold),0 0 50px #ff0;}
    .rank:nth-of-type(2){color:var(--silver);font-size:2.05rem;text-shadow:0 0 30px var(--silver),0 0 45px #ccc;}
    .rank:nth-of-type(3){color:var(--bronze);font-size:2rem;text-shadow:0 0 28px var(--bronze),0 0 40px #fa0;}
    .name{display:flex;align-items:center;gap:28px;font-size:1.15rem;}
    .avatar{width:72px;height:72px;border-radius:20px;overflow:hidden;
      box-shadow:0 0 28px rgba(0,0,0,.7),0 0 0 2px rgba(255,255,255,.25);flex-shrink:0;
      transition:transform .3s ease,box-shadow .3s;}
    tr:hover .avatar{transform:scale(1.35) rotate(10deg);box-shadow:0 0 40px rgba(255,255,255,.3);}
    .avatar img{width:100%;height:100%;object-fit:cover;}
    .discord-tag{display:flex;align-items:center;gap:10px;font-size:.94rem;color:var(--discord);margin-top:6px;}
    .discord-tag i{filter:drop-shadow(0 0 10px #5865f2);animation:discordPulse 2.5s infinite alternate;}
    @keyframes discordPulse{from{filter:drop-shadow(0 0 10px #5865f2);}to{filter:drop-shadow(0 0 20px #5865f2);}}
    .empty-slot{color:#666;font-style:italic;font-size:1.08rem;}
    .error-msg{text-align:center;padding:40px;color:#f88;font-size:1.1rem;}
    .retry-btn{margin-top:16px;padding:12px 32px;background:#f44;color:#fff;border:none;
      border-radius:12px;cursor:pointer;font-weight:600;transition:.3s;}
    .retry-btn:hover{background:#f66;transform:scale(1.05);}
    .last-updated{font-size:.95rem;color:var(--muted);text-align:center;margin:20px 0;opacity:.9;}
    /* LOADER */
    #loader{position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;
      align-items:center;justify-content:center;transition:opacity 1s ease;z-index:100;cursor:pointer;}
    #logo{font-size:5.5rem;font-weight:900;text-transform:uppercase;color:var(--accent);
      letter-spacing:9px;background:linear-gradient(45deg,#fff,#ccc);-webkit-background-clip:text;
      background-clip:text;color:transparent;animation:glow 2.5s ease-in-out infinite alternate;}
    @keyframes glow{from{text-shadow:0 0 25px var(--accent);}to{text-shadow:0 0 70px var(--accent),0 0 140px var(--accent);}}
    footer{margin-top:18px;text-align:center;font-size:.85rem;color:var(--muted);position:absolute;
      bottom:20px;left:0;right:0;}
    footer a{color:var(--muted);text-decoration:none;transition:.2s;}
    footer a:hover{color:#eee;text-decoration:underline;}
    .credit{font-size:.78rem;color:#777;margin-top:12px;opacity:.7;font-style:italic;}
    .hidden{display:none!important;}
    @media (max-width:800px){
      #app{padding:20px;}h1{font-size:2.5rem;}
      .avatar{width:60px;height:60px;}
      th,td{padding:18px 20px;}
      .rank{font-size:1.6rem;}
    }
    @media (max-width:500px){
      h1{font-size:2rem;letter-spacing:2px;}
      .name{gap:16px;font-size:1rem;}
      .avatar{width:50px;height:50px;}
      th,td{padding:14px 16px;}
    }
  </style>
</head>
<body>
  <div class="stars" id="stars"></div>

  <!-- LOADER -->
  <div id="loader" tabindex="0" role="button" aria-label="Enter">
    <div id="logo">GOONING</div>
    <div style="margin-top:22px;color:#999;font-size:1.3rem;">Click or press Enter</div>
  </div>

  <div id="app" class="hidden">
    <h1>Gooning Leaderboard</h1>

    <div id="loading" style="text-align:center;color:#bbb;margin:32px 0;font-size:1.1rem;">Loading leaderboard...</div>
    <div id="error" class="error-msg hidden">
      Failed to load leaderboard.<br>
      <button class="retry-btn" onclick="fetchLeaderboard()">Retry</button>
    </div>

    <div class="table-container">
      <table id="board" class="hidden">
        <thead><tr><th style="width:130px">Rank</th><th>Player</th></tr></thead>
        <tbody id="rows"></tbody>
      </table>
    </div>

    <div class="last-updated" id="updated"></div>

    <footer>
      Auto-refreshed every 60s • <a href="leaderboard.json" target="_blank">view raw JSON</a>
      <div class="credit">Site made by Xen</div>
    </footer>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    const stars = $('#stars');
    let starCnt = 0;

    function addStar(){
      if(starCnt>120) return;
      const s=document.createElement('div'); s.className='star';
      const sz = Math.random()*2.5+0.8;
      s.style.width=s.style.height=`${sz}px`;
      s.style.left=`${Math.random()*100}vw`;
      s.style.animationDuration=`${Math.random()*6+4}s`;
      s.style.animationDelay=`${Math.random()*3}s`;
      stars.appendChild(s); starCnt++;
      setTimeout(()=>{s.remove();starCnt--;},10000);
    }
    setInterval(addStar,250);

    function enterHub(){
      const loader=$('loader');
      loader.style.opacity='0';
      setTimeout(()=>{
        loader.classList.add('hidden');
        $('app').classList.remove('hidden');
        fetchLeaderboard();
        setInterval(fetchLeaderboard,60000); // Every 60s
      },800);
    }
    const loader=$('loader');
    loader.addEventListener('click',enterHub);
    loader.addEventListener('keydown',e=>{if(e.key==='Enter'||e.key===' '){e.preventDefault();enterHub();}});
    loader.focus();

    async function fetchLeaderboard(){
      const loading=$('loading'), error=$('error'), board=$('board'), rows=$('rows'), updated=$('updated');
      loading.classList.remove('hidden');
      error.classList.add('hidden');
      board.classList.add('hidden');

      try{
        const r=await fetch('leaderboard.json?'+Date.now());
        if(!r.ok) throw new Error('HTTP '+r.status);
        const data=await r.json();
        const list = Array.isArray(data) ? data : (data.leaderboard||[]);
        const time = data.updated || new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});

        const padded = Array(100).fill().map((_,i)=>list[i]||{rank:i+1});
        rows.innerHTML = padded.map((p,idx)=>{
          const av = p.discordId && p.avatar 
            ? `https://cdn.discordapp.com/avatars/${p.discordId}/${p.avatar}.${p.avatar.startsWith('a_')?'gif':'webp'}?size=80` 
            : 'https://cdn.discordapp.com/embed/avatars/0.png';
          const rank = p.rank||idx+1;
          return `<tr>
            <td class="rank">${rank}</td>
            <td class="name">
              ${p.name||p.discord?`
                <div class="avatar"><img src="${av}" onerror="this.src='https://cdn.discordapp.com/embed/avatars/0.png'" alt="${e(p.name||'User')}"></div>
                <div>
                  <div style="font-weight:600;font-size:1.1rem;">${e(p.name||'Unknown User')}</div>
                  ${p.discord?`<div class="discord-tag"><i class="fab fa-discord"></i>${e(p.discord)}</div>`:''}
                </div>`:`<div class="empty-slot">— Empty Slot —</div>`}
            </td>
          </tr>`;
        }).join('');

        updated.textContent=`Last updated: ${time}`;
        loading.classList.add('hidden');
        board.classList.remove('hidden');
      }catch(err){
        console.error(err);
        loading.classList.add('hidden');
        error.classList.remove('hidden');
      }
    }

    function e(t){
      const d=document.createElement('div');
      d.textContent=t;
      return d.innerHTML;
    }
  </script>
</body>
</html>
