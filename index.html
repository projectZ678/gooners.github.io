<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Gooning Leaderboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0a0a0a;--panel:#111;--text:#eee;--muted:#888;--glow:rgba(255,255,255,.2);
  --accent:#fff;--discord:#5865F2;--transition:300ms ease;
  font-family:'Inter',system-ui,sans-serif;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  min-height:100vh;background:
    radial-gradient(circle at 30% 20%,rgba(255,255,255,.04),transparent 30%),
    radial-gradient(circle at 80% 80%,rgba(255,255,255,.03),transparent 40%),
    var(--bg);
  color:var(--text);display:flex;flex-direction:column;align-items:center;padding:40px 20px;
}
h1{
  font-size:2.8rem;font-weight:900;text-align:center;margin-bottom:30px;
  color:var(--accent);text-shadow:0 0 20px var(--glow);letter-spacing:2px;
}
#loader{
  position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;
  align-items:center;justify-content:center;z-index:10;transition:opacity 700ms ease;
}
#logo{
  font-size:3rem;font-weight:900;text-transform:uppercase;color:var(--accent);
  letter-spacing:3px;animation:glow 2s infinite alternate;cursor:pointer;
}
@keyframes glow{
  from{text-shadow:0 0 10px var(--accent);opacity:.8}
  to{text-shadow:0 0 40px var(--accent),0 0 80px var(--accent);opacity:1}
}
table{
  width:100%;max-width:900px;border-collapse:collapse;margin-top:24px;
  background:var(--panel);border-radius:16px;overflow:hidden;
  box-shadow:0 0 60px rgba(0,0,0,.7),0 0 30px rgba(255,255,255,.03) inset;
}
thead{
  background:rgba(255,255,255,.08);text-transform:uppercase;
  font-size:.85rem;letter-spacing:1.5px;color:var(--muted);
}
th,td{padding:18px 20px;border-bottom:1px solid rgba(255,255,255,.06);text-align:left}
tr:hover{
  background:rgba(255,255,255,.04);transform:translateY(-3px);
  box-shadow:0 8px 20px rgba(255,255,255,.05);
  transition:transform var(--transition),box-shadow var(--transition);
}
.rank{font-weight:800;color:var(--accent);font-size:1.3rem}
.name{display:flex;align-items:center;gap:14px}
.avatar{width:48px;height:48px;border-radius:12px;overflow:hidden;box-shadow:0 0 15px rgba(255,255,255,.1)}
.avatar img{width:100%;height:100%;object-fit:cover}
.discord-tag{display:flex;align-items:center;gap:8px;font-size:.9rem;color:var(--discord);font-weight:600}
.score{text-align:right;font-weight:700;font-size:1.1rem}
.last-updated{font-size:.8rem;color:var(--muted);text-align:center;margin:20px 0}
footer{margin-top:40px;text-align:center;font-size:.85rem;color:var(--muted)}
footer a{color:var(--muted);text-decoration:underline}
.hidden{display:none}
</style>
</head>
<body>

<!-- LOADER -->
<div id="loader">
  <div id="logo">GOONING</div>
  <div style="margin-top:16px;color:#777;font-size:1.1rem;">Click to enter</div>
</div>

<!-- PUBLIC LEADERBOARD -->
<h1>GOONING LEADERBOARD</h1>
<div id="loading" style="color:#aaa;margin:30px;font-size:1.1rem">Loading leaderboard...</div>

<table id="board" class="hidden">
  <thead>
    <tr><th>Rank</th><th>Player</th><th class="score">Score</th></tr>
  </thead>
  <tbody id="rows"></tbody>
</table>

<div class="last-updated" id="updated"></div>

<footer>
  Public View â€¢ <a href="leaderboard.json" target="_blank">view raw JSON</a><br>
  <small>Only XEN can edit via <a href="admin.html" target="_blank">admin.html</a></small>
</footer>

<script>
const REPO = 'projectZ678/gooning-leaderboard';
const FILE = 'leaderboard.json';
const API = 'https://api.github.com';

async function load() {
  try {
    const res = await fetch(`${API}/repos/${REPO}/contents/${FILE}`);
    if (!res.ok) {
      $('#loading').textContent = 'Leaderboard not ready yet.';
      return;
    }
    const data = await res.json();
    const { leaderboard, updated } = JSON.parse(atob(data.content));
    render(leaderboard || []);
    const time = updated ? new Date(updated).toLocaleTimeString() : 'never';
    $('#updated').textContent = `Last updated: ${time}`;
  } catch (e) {
    $('#loading').textContent = 'Failed to load.';
  }
}

function render(players) {
  const sorted = [...players].sort((a, b) => (b.score || 0) - (a.score || 0));
  $('#loading').classList.add('hidden');
  $('#board').classList.remove('hidden');
  const rows = $('#rows');
  rows.innerHTML = sorted.length ? sorted.map((p, i) => `
    <tr>
      <td class="rank">#${i + 1}</td>
      <td class="name">
        <div class="avatar">
          <img src="${p.avatar || 'https://cdn.discordapp.com/embed/avatars/0.png'}"
               onerror="this.src='https://cdn.discordapp.com/embed/avatars/0.png'">
        </div>
        <div>
          <div style="font-weight:700">${escape(p.name || 'Unknown')}</div>
          ${p.discord ? `<div class="discord-tag"><i class="fab fa-discord"></i>${escape(p.discord)}</div>` : ''}
        </div>
      </td>
      <td class="score">${(p.score || 0).toLocaleString()}</td>
    </tr>
  `).join('') : '<tr><td colspan="3" style="text-align:center;padding:40px;color:#666;font-size:1.1rem;">No gooners yet.<br>Check back soon!</td></tr>';
}

function escape(t) {
  const div = document.createElement('div');
  div.textContent = t;
  return div.innerHTML;
}

$('#loader').onclick = () => {
  $('#loader').style.opacity = '0';
  setTimeout(() => {
    $('#loader').style.display = 'none';
    load();
  }, 700);
};

// Auto-refresh every 30 seconds
load();
setInterval(load, 30000);
</script>
</body>
</html>
