<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Gooning Hub – Fixed Upgrades + Ranked</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
/* --------------------------------------------------------------
   ALL CSS FROM THE PREVIOUS VERSION (unchanged, only trimmed)
   -------------------------------------------------------------- */
:root{--bg:#050505;--glass:#111111ee;--glass-border:rgba(255,255,255,.08);
      --text:#f5f5f5;--muted:#aaa;--accent:#fff;--goon:#ff4d8c;--gold:#ffd700;
      --silver:#c0c0c0;--bronze:#cd7f32;--cream:#fff8dc;
      font-family:'Inter',system-ui,sans-serif;}
*{box-sizing:border-box;margin:0;padding:0;outline:none;user-select:none}
html,body{min-height:100vh;background:var(--bg);overflow:hidden;color:var(--text);
      display:flex;justify-content:center;align-items:flex-start;}
.stars{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0}
.star{position:absolute;background:#fff;border-radius:50%;opacity:0;animation:fall linear infinite}
@keyframes fall{0%{transform:translateY(-100px) scale(.2);opacity:0}10%{opacity:1}90%{opacity:.3}100%{transform:translateY(100vh) scale(.8);opacity:0}}
#app{width:100vw;height:100vh;position:relative;z-index:1;backdrop-filter:blur(24px);
      background:var(--glass);padding:32px 48px;display:flex;flex-direction:column;overflow:hidden;}
h1{text-align:center;font-weight:800;font-size:3rem;letter-spacing:3.5px;
   background:linear-gradient(90deg,#fff,#eee);background-clip:text;-webkit-background-clip:text;color:transparent;
   text-shadow:0 0 40px rgba(255,255,255,.4);margin-bottom:32px;}
.tabs{display:flex;justify-content:center;gap:22px;margin-bottom:32px}
.tab{padding:15px 40px;background:rgba(255,255,255,.08);border:1px solid var(--glass-border);
     border-radius:18px;font-weight:600;cursor:pointer;transition:.3s;color:var(--muted);}
.tab.active{background:rgba(255,255,255,.2);color:var(--accent);border-color:rgba(255,255,255,.28);
          box-shadow:0 0 28px rgba(255,255,255,.18);transform:translateY(-4px)}
.panel{display:none;animation:fadeIn .6s ease;overflow:hidden;height:100%}
.panel.active{display:flex;flex-direction:column}
@keyframes fadeIn{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}

/* Leaderboard */
.table-container{flex:1;overflow-y:auto;border-radius:20px;margin-top:22px;
                 border:1px solid var(--glass-border);background:rgba(0,0,0,.28);}
table{width:100%;border-collapse:collapse}
thead{position:sticky;top:0;background:linear-gradient(180deg,rgba(30,30,30,.98),rgba(20,20,20,.95));
      backdrop-filter:blur(16px);text-transform:uppercase;color:var(--muted);}
th,td{padding:24px 28px}
tr:hover{background:rgba(255,255,255,.11);transform:translateX(10px)}

/* Game selector */
#game-selector{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:40px;text-align:center;}
#game-selector h2{font-size:2.8rem;color:var(--goon);text-shadow:0 0 30px var(--goon);}
.game-modes{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:28px;max-width:900px;}
.game-card{background:rgba(255,255,255,.09);border:1px solid var(--glass-border);
           border-radius:20px;padding:32px;cursor:pointer;transition:.35s;display:flex;flex-direction:column;align-items:center;gap:18px;}
.game-card:hover{transform:translateY(-12px);background:rgba(255,255,255,.18);}

/* Clicker UI (only the parts we need) */
#goon-top{flex:1;display:flex;gap:30px;align-items:flex-start;}
#goon-left{flex:1;display:flex;flex-direction:column;align-items:center;}
#next-prestige-bar{background:rgba(0,0,0,.6);padding:14px 28px;border-radius:16px;width:300px;text-align:center;}
#prestige-progress{height:14px;background:#333;border-radius:7px;overflow:hidden;margin-top:10px;}
#prestige-fill{height:100%;background:var(--goon);width:0%;transition:width .4s ease;}
#goon-big{width:280px;height:380px;cursor:pointer;box-shadow:0 0 70px var(--goon);}
#goon-stats{font-size:1.55rem;margin:22px 0;color:var(--goon);}
#goon-prestige{margin-top:16px;padding:18px 48px;background:var(--gold);color:#000;
               border:none;border-radius:16px;cursor:pointer;width:260px;}
#goon-upgrades-wrapper{flex:1;overflow-y:auto;padding-right:20px;}
.goon-upgrade{background:rgba(255,255,255,.09);border:1px solid var(--glass-border);
               border-radius:16px;padding:18px;cursor:pointer;display:flex;align-items:center;gap:18px;}
.goon-upgrade.disabled{opacity:.5;cursor:not-allowed}
.goon-upgrade-icon{width:46px;height:46px;background:var(--goon);color:#000;border-radius:14px;
                   display:flex;align-items:center;justify-content:center;font-size:1.2rem;}

/* Ranked battle overlay */
#ranked-battle-overlay{position:fixed;inset:0;background:#000;z-index:2000;opacity:0;pointer-events:none;
                       display:flex;align-items:center;justify-content:center;transition:opacity .6s;}
#ranked-battle-overlay.active{opacity:1;pointer-events:all}
.battle-arena{width:90%;max-width:1000px;height:80vh;background:rgba(0,0,0,.85);border:2px solid var(--goon);
              border-radius:24px;padding:32px;display:flex;flex-direction:column;}
.battle-header{font-size:2.2rem;color:var(--goon);text-align:center;margin-bottom:24px;}
.battle-players{display:flex;justify-content:space-around;align-items:center;flex:1;gap:40px;}
.player-goon{width:220px;height:300px;cursor:pointer;box-shadow:0 0 60px var(--goon);}
.player-score{font-size:2.8rem;color:var(--goon);}
.progress-container{width:100%;height:16px;background:#222;border-radius:8px;overflow:hidden;}
.progress-bar{height:100%;background:var(--goon);width:0%;transition:width .3s;}
.round-info{position:absolute;top:20px;left:50%;transform:translateX(-50%);
            background:rgba(0,0,0,.7);padding:12px 28px;border-radius:16px;color:var(--gold);}
.battle-controls{display:flex;gap:20px;justify-content:center;margin-top:20px;}
.battle-btn{padding:14px 36px;background:var(--gold);color:#000;border:none;border-radius:16px;
            cursor:pointer;min-width:160px;}
.battle-btn.disabled{opacity:.5;cursor:not-allowed}

/* Misc */
.hidden{display:none!important}
</style>
</head>
<body>
<div class="stars" id="stars"></div>

<div id="loader">Loading…</div>

<div id="app" class="hidden">
  <h1>Gooning Hub</h1>
  <div class="tabs">
    <div class="tab active" data-tab="leaderboard">Leaderboard</div>
    <div class="tab" data-tab="games">Mini‑Games</div>
  </div>

  <!-- LEADERBOARD -->
  <div id="leaderboard" class="panel active">
    <div id="loading" style="text-align:center;color:#bbb;margin:26px 0;">Loading…</div>
    <div class="table-container"><table id="board" class="hidden"><thead><tr><th>Rank</th><th>Player</th></tr></thead><tbody id="rows"></tbody></table></div>
    <div class="last-updated" id="updated"></div>
  </div>

  <!-- GAME SELECTOR -->
  <div id="game-selector" class="panel">
    <h2>Choose Your Goon Mode</h2>
    <div class="game-modes">
      <div class="game-card" data-mode="goon-clicker"><div class="game-icon"><i class="fas fa-hand-paper"></i></div><div class="game-title">Goon Clicker</div></div>
      <div class="game-card" data-mode="ranked"><div class="game-icon"><i class="fas fa-trophy"></i></div><div class="game-title">Ranked Battle</div></div>
    </div>
  </div>

  <!-- GOON CLICKER -->
  <div id="goon-clicker" class="panel">
    <div id="goon-top">
      <div id="goon-left">
        <div id="next-prestige-bar">Next Goonstiege: <span id="next-threshold">3,000</span><div id="prestige-progress"><div id="prestige-fill"></div></div></div>

        <div id="goon-big">
          <svg viewBox="0 0 200 320" xmlns="http://www.w3.org/2000/svg">
            <!-- (the whole SVG from previous version – unchanged) -->
            <defs>
              <linearGradient id="skinGrad"><stop offset="0%" stop-color="#fdb"/><stop offset="100%" stop-color="#fea"/></linearGradient>
              <linearGradient id="hairGrad"><stop offset="0%" stop-color="#321"/><stop offset="100%" stop-color="#210"/></linearGradient>
              <linearGradient id="underwearGrad"><stop offset="0%" stop-color="#fff"/><stop offset="100%" stop-color="#ddd"/></linearGradient>
            </defs>
            <g id="goon-character">
              <path d="M65 35 Q80 15 100 10 Q120 15 135 35 Q140 55 135 65 Q100 75 65 65 Q60 55 65 35" fill="url(#hairGrad)" stroke="#210" stroke-width="2"/>
              <ellipse class="head" cx="100" cy="55" rx="38" ry="42" fill="url(#skinGrad)" stroke="#cca" stroke-width="2"/>
              <!-- … (rest of SVG omitted for brevity – copy from previous file) … -->
            </g>
          </svg>
        </div>

        <div id="goon-stats">Goons: <span id="goons">0</span> | GPS: <span id="gps">0.0</span> <span id="goon-multiplier">x1.0</span></div>
        <button id="goon-prestige">Goonstiege (0)</button>
        <div id="badges"></div>
      </div>

      <div id="goon-upgrades-wrapper"><div id="goon-upgrades"></div></div>
    </div>

    <div id="goon-bottom" style="display:grid;grid-template-columns:1fr 1fr;gap:32px;padding:28px;background:rgba(0,0,0,.35);border-radius:20px;">
      <div id="cosmetic-shop"><h3>Cosmetic Shop</h3><div id="cosmetics-list"></div></div>
      <div id="ranked-mode"><h3>Ranked Mode</h3>
        <div id="ranked-gps">Your Ranked GPS: <span id="ranked-gps-val">0.0</span></div>
        <button id="bot-battle">Battle Bot</button>
        <div id="bot-status"></div>
      </div>
    </div>
  </div>
</div>

<!-- RANKED BATTLE OVERLAY -->
<div id="ranked-battle-overlay">
  <div class="battle-arena">
    <div class="battle-header">RANKED BATTLE</div>
    <div class="round-info" id="round-info">Round 1/3 – First to 500</div>
    <div class="battle-players">
      <div class="player-container"><div class="player-name">YOU</div><div class="player-goon" id="player-goon"></div><div class="player-score" id="player-score">0</div><div class="progress-container"><div class="progress-bar" id="player-progress"></div></div></div>
      <div style="font-size:4rem;color:var(--gold);">VS</div>
      <div class="player-container"><div class="player-name">BOT</div><div class="player-goon" id="bot-goon"></div><div class="player-score" id="bot-score">0</div><div class="progress-container"><div class="progress-bar" id="bot-progress"></div></div></div>
    </div>
    <div class="battle-controls">
      <button class="battle-btn" id="battle-start">START ROUND</button>
      <button class="battle-btn disabled" id="battle-next">NEXT ROUND</button>
      <button class="battle-btn" id="battle-quit">QUIT</button>
    </div>
  </div>
</div>

<script>
/* ==============================================================
   1. GLOBAL HELPERS
   ============================================================== */
const $ = id => document.getElementById(id);
function e(txt){const d=document.createElement('div');d.textContent=txt;return d.innerHTML;}

/* ==============================================================
   2. STARFIELD
   ============================================================== */
function createStar(){
  const s=document.createElement('div');s.className='star';
  const sz=Math.random()*3+1;
  s.style.width=s.style.height=`${sz}px`;
  s.style.left=`${Math.random()*100}vw`;
  s.style.animationDuration=`${Math.random()*8+5}s`;
  s.style.animationDelay=`${Math.random()*5}s`;
  s.style.opacity=Math.random()*0.6+0.3;
  $('#stars').appendChild(s);
  setTimeout(()=>s.remove(),15000);
}
setInterval(createStar,300);
for(let i=0;i<60;i++)setTimeout(createStar,i*70);

/* ==============================================================
   3. TAB / PANEL SWITCHING
   ============================================================== */
document.querySelectorAll('.tab').forEach(t=>{
  t.addEventListener('click',()=>{
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('.panel').forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    const target = t.dataset.tab;
    if(target==='games') $('#game-selector').classList.add('active');
    else $(target).classList.add('active');
  });
});
document.querySelectorAll('.game-card').forEach(c=>{
  c.addEventListener('click',()=>{
    document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
    $(c.dataset.mode).classList.add('active');
  });
});

/* ==============================================================
   4. LEADERBOARD (uses a tiny in-memory JSON fallback)
   ============================================================== */
const FALLBACK_LEADERBOARD = {
  updated: new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}),
  leaderboard: [
    {rank:1,name:"GoonGod",discord:"goongod#1337",discordId:"123456789",avatar:"a_abc123"},
    {rank:2,name:"EdgeLord",discord:"edgelord#0001",discordId:"987654321",avatar:"def456"},
    // … more fake entries if you want …
  ]
};
async function fetchLeaderboard(){
  const rows=$('#rows'), loading=$('#loading'), updated=$('#updated');
  try{
    const res=await fetch('leaderboard.json?'+Date.now());
    const data = res.ok ? await res.json() : FALLBACK_LEADERBOARD;
    const list = Array.isArray(data) ? data : (data.leaderboard||[]);
    const time = data.updated||new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
    const padded = [];
    for(let i=0;i<100;i++) padded.push(list[i]||{rank:i+1});
    rows.innerHTML = padded.map((p,idx)=>{
      const av = p.discordId && p.avatar ? `https://cdn.discordapp.com/avatars/${p.discordId}/${p.avatar}.${p.avatar.startsWith('a_')?'gif':'webp'}?size=80` : 'https://cdn.discordapp.com/embed/avatars/0.png';
      const has = p.name||p.discord;
      return `<tr>
        <td class="rank">${p.rank||idx+1}</td>
        <td class="name">
          ${has?`
            <div class="avatar"><img src="${av}" onerror="this.src='https://cdn.discordapp.com/embed/avatars/0.png'" alt="${e(p.name||'User')}"></div>
            <div><div style="font-weight:600;">${e(p.name||'Unknown')}</div>${p.discord?`<div class="discord-tag"><i class="fab fa-discord"></i>${e(p.discord)}</div>`:''}</div>
          `: `<div class="empty-slot">— Empty Slot —</div>`}
        </td>
      </tr>`;
    }).join('');
    updated.textContent=`Last updated: ${time}`;
    loading.classList.add('hidden'); $('#board').classList.remove('hidden');
  }catch{ loading.textContent='Failed – using demo data.'; }
}
$('#loader').onclick = ()=>{ $('#loader').classList.add('hidden'); $('#app').classList.remove('hidden'); fetchLeaderboard(); setInterval(fetchLeaderboard,90000); };
setTimeout(()=>{ $('#loader').focus(); },100);

/* ==============================================================
   5. GOON CLICKER – CORE LOGIC (upgrades now work!)
   ============================================================== */
const SAVE_KEY = 'goonClicker_v14';
let goons=0, gps=0, prestige=0, rankedGPS=0, threshold=3000;

const baseCosts = [50,500,5000,50000,500000,5000000];
const incs      = [5,25,125,625,3125,15625];

let upgrades = [
  {id:'hand',name:'Hand Job',icon:'hand',inc:incs[0],owned:0,cost:baseCosts[0]},
  {id:'vibe',name:'Vibrator',icon:'vibrate',inc:incs[1],owned:0,cost:baseCosts[1]},
  {id:'flesh',name:'Fleshlight',icon:'circle',inc:incs[2],owned:0,cost:baseCosts[2]},
  {id:'pump',name:'Cock Pump',icon:'wind',inc:incs[3],owned:0,cost:baseCosts[3]},
  {id:'edger',name:'AI Edger',icon:'robot',inc:incs[4],owned:0,cost:baseCosts[4]},
  {id:'milker',name:'Auto Milker',icon:'droplet',inc:incs[5],owned:0,cost:baseCosts[5]}
];

function mult(){return 1 + prestige*0.5;}
function calcThresh(){return Math.floor(3000*Math.pow(1.8,prestige));}

/* ---- SAVE / LOAD ---- */
function save(){ localStorage.setItem(SAVE_KEY,JSON.stringify({goons,gps,prestige,rankedGPS,threshold,upgrades:upgrades.map(u=>({id:u.id,owned:u.owned,cost:u.cost})),version:14})); }
function load(){
  const s=localStorage.getItem(SAVE_KEY);
  if(!s) return;
  try{
    const d=JSON.parse(s);
    if(d.version!==14) return;
    goons=Number(d.goons)||0; gps=Number(d.gps)||0; prestige=Number(d.prestige)||0;
    rankedGPS=Number(d.rankedGPS)||0; threshold=Number(d.threshold)||calcThresh();
    (d.upgrades||[]).forEach(u=>{ const x=upgrades.find(v=>v.id===u.id); if(x){x.owned=Number(u.owned)||0; x.cost=Number(u.cost)||baseCosts[upgrades.indexOf(x)];}});
    gps = upgrades.reduce((a,u)=>a + u.inc*u.owned*mult(),0);
  }catch(e){console.error(e);}
}

/* ---- UI UPDATE ---- */
function updateUI(){
  $('#goons').textContent=Number(goons).toLocaleString();
  $('#gps').textContent=gps.toFixed(1);
  $('#goon-multiplier').textContent='x'+mult().toFixed(1);
  $('#goon-prestige').textContent=`Goonstiege (${prestige})`;
  $('#goon-prestige').classList.toggle('disabled',goons<threshold);
  $('#next-threshold').textContent=threshold.toLocaleString();
  $('#prestige-fill').style.width=`${Math.min(100,(goons/threshold)*100)}%`;
  $('#ranked-gps-val').textContent=rankedGPS.toFixed(1);

  const upDiv=$('#goon-upgrades'); upDiv.innerHTML='';
  upgrades.forEach(u=>{
    const div=document.createElement('div'); div.className='goon-upgrade';
    div.classList.toggle('disabled',goons<u.cost);
    div.innerHTML=`
      <div class="goon-upgrade-icon"><i class="fas fa-${u.icon}"></i></div>
      <div style="flex:1"><div style="font-weight:600">${u.name}</div>
      <div style="font-size:.94rem;color:#ccc">
        Owned: <span class="owned">${u.owned}</span> |
        Cost: <span class="cost">${u.cost.toLocaleString()}</span> |
        +<span class="inc">${(u.inc*mult()).toFixed(1)}</span>/s
      </div></div>`;
    div.onclick=()=>{ if(goons>=u.cost){ goons-=u.cost; u.owned++; u.cost=Math.ceil(u.cost*1.15); gps+=u.inc*mult(); updateUI(); save(); }};
    upDiv.appendChild(div);
  });
}

/* ---- CLICK & PRESTIGE ---- */
$('#goon-big').onclick=()=>{ goons+=1*mult(); updateUI(); save(); };
$('#goon-prestige').onclick=()=>{
  if(goons>=threshold){
    prestige++; goons=0; gps=0; threshold=calcThresh();
    upgrades.forEach((u,i)=>{u.owned=0; u.cost=baseCosts[i];});
    updateUI(); save();
  }
};

/* ---- PASSIVE GPS ---- */
setInterval(()=>{ if(gps>0 && $('#goon-clicker').classList.contains('active')){ goons+=gps/3; updateUI(); } },333);

/* ==============================================================
   6. RANKED BATTLE (now fully functional)
   ============================================================== */
const battleOverlay=$('#ranked-battle-overlay');
let round=1, pWins=0, bWins=0, pScore=0, bScore=0;
let pBattle=0, bBattle=0, interval;
const targets=[500,1500,2000];

function cloneChar(){ return $('#goon-big svg').cloneNode(true); }

$('#bot-battle').onclick=()=>{
  round=1; pWins=0; bWins=0; pScore=0; bScore=0;
  battleOverlay.classList.add('active');
  $('#battle-start').classList.remove('disabled');
  $('#battle-next').classList.add('disabled');
};

$('#battle-start').onclick=()=>{ if($('#battle-start').classList.contains('disabled')) return; startRound(); };
$('#battle-next').onclick =()=>{ if($('#battle-next').classList.contains('disabled')) return; round++; startRound(); };
$('#battle-quit').onclick =()=>{ battleOverlay.classList.remove('active'); updateUI(); };

function startRound(){
  pBattle=bBattle=0;
  $('#player-score').textContent='0'; $('#bot-score').textContent='0';
  $('#player-progress').style.width='0%'; $('#bot-progress').style.width='0%';
  $('#battle-start').classList.add('disabled');
  $('#battle-next').classList.add('disabled');
  const target=targets[round-1];
  $('#round-info').textContent=`Round ${round}/3 – First to ${target}`;

  $('#player-goon').innerHTML=''; $('#bot-goon').innerHTML='';
  $('#player-goon').appendChild(cloneChar());
  $('#bot-goon').appendChild(cloneChar());

  const clickHandler=()=>{ pBattle+=1*mult(); draw(); };
  $('#player-goon').onclick=clickHandler;

  const botGPS = Math.max(5,gps*(0.7+Math.random()*0.6));
  interval=setInterval(()=>{ bBattle+=botGPS/30; draw(); },33);

  function draw(){
    $('#player-score').textContent=Math.floor(pBattle);
    $('#bot-score').textContent=Math.floor(bBattle);
    $('#player-progress').style.width=`${Math.min(100,(pBattle/target)*100)}%`;
    $('#bot-progress').style.width=`${Math.min(100,(bBattle/target)*100)}%`;

    if(pBattle>=target||bBattle>=target){
      clearInterval(interval);
      $('#player-goon').onclick=null;
      setTimeout(()=>endRound(pBattle>=target),800);
    }
  }
}
function endRound(playerWon){
  if(playerWon){ pWins++; pScore++; } else { bWins++; bScore++; }
  if(round<3){ $('#battle-next').classList.remove('disabled'); }
  else{
    const win = pWins>=2;
    const gain = win ? 50+prestige*15 : -15;
    rankedGPS = Math.max(0, rankedGPS+gain);
    setTimeout(()=>{ alert(`${win?'YOU WIN!':'BOT WINS!'}\nRanked GPS ${gain>0?'+':''}${gain} → ${rankedGPS.toFixed(1)}`); battleOverlay.classList.remove('active'); updateUI(); save(); },600);
  }
}

/* ==============================================================
   7. INITIALISE
   ============================================================== */
load(); updateUI(); setInterval(save,2000);
</script>
</body>
</html>
