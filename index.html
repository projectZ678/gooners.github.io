<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Gooning Leaderboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
/* ────────────────────────────────── VARIABLES ────────────────────────────────── */
:root{
  --bg:#050505;
  --glass:#111111ee;
  --glass-border:rgba(255,255,255,0.08);
  --text:#f5f5f5;
  --muted:#aaaaaa;
  --glow:#ffffff;
  --accent:#ffffff;
  --discord:#cccccc;
  --transition:0.35s cubic-bezier(0.25,0.8,0.25,1);
  --scrollbar:#333;
  font-family:'Inter',system-ui,sans-serif;
}
*{box-sizing:border-box;margin:0;padding:0}

/* ────────────────────────────────── BODY & LAYOUT ────────────────────────────────── */
html,body{min-height:100vh;background:var(--bg);overflow:hidden;color:var(--text)}
body{
  background:
    radial-gradient(circle at 15% 15%,rgba(255,255,255,.09),transparent 35%),
    radial-gradient(circle at 85% 85%,rgba(255,255,255,.07),transparent 40%),
    radial-gradient(circle at 50% 50%,rgba(100,100,255,.03),transparent 50%),
    var(--bg);
  display:flex;align-items:center;justify-content:center;
  padding:16px;
}

/* ────────────────────────────────── APP CONTAINER ────────────────────────────────── */
#app{
  max-width:860px;width:100%;position:relative;
  backdrop-filter:blur(16px);
  background:var(--glass);
  border:1px solid var(--glass-border);
  border-radius:20px;
  padding:28px 24px;
  box-shadow:
    0 12px 40px rgba(0,0,0,.7),
    inset 0 0 30px rgba(255,255,255,.04);
  transition:transform .4s var(--transition),box-shadow .4s;
}
#app:hover{
  transform:translateY(-6px);
  box-shadow:0 16px 50px rgba(0,0,0,.8),0 0 30px rgba(255,255,255,.08);
}

/* ────────────────────────────────── TITLE ────────────────────────────────── */
h1{
  text-align:center;font-weight:800;font-size:2.3rem;letter-spacing:1.6px;
  color:var(--accent);text-shadow:0 0 20px rgba(255,255,255,.4);
  margin-bottom:18px;background:linear-gradient(90deg,#fff,#ddd);background-clip:text;
  -webkit-background-clip:text;color:transparent;
}

/* ────────────────────────────────── TABLE CONTAINER ────────────────────────────────── */
.table-container{
  max-height:65vh; /* Scrollable */
  overflow-y:auto;
  border-radius:14px;
  margin-top:16px;
  border:1px solid var(--glass-border);
  background:rgba(0,0,0,.15);
  box-shadow:inset 0 4px 10px rgba(0,0,0,.3);
}

/* Custom Scrollbar */
.table-container::-webkit-scrollbar{width:8px}
.table-container::-webkit-scrollbar-track{background:transparent}
.table-container::-webkit-scrollbar-thumb{
  background:var(--scrollbar);border-radius:4px;
}
.table-container::-webkit-scrollbar-thumb:hover{background:#555}

/* ────────────────────────────────── TABLE ────────────────────────────────── */
table{
  width:100%;border-collapse:collapse;background:transparent;
}
thead{
  position:sticky;top:0;z-index:10;
  background:linear-gradient(180deg,rgba(30,30,30,.95),rgba(20,20,20,.9));
  backdrop-filter:blur(8px);
  text-transform:uppercase;font-size:.72rem;letter-spacing:1.4px;
  color:var(--muted);border-bottom:1px solid var(--glass-border);
}
th,td{
  padding:10px 14px;
  border-bottom:1px solid rgba(255,255,255,.05);
  transition:all .3s var(--transition);
}
tr:hover{
  background:rgba(255,255,255,.07);
  transform:translateX(4px);
  box-shadow:0 6px 16px rgba(255,255,255,.06);
}

/* Rank Styling */
.rank{
  font-weight:800;color:var(--accent);font-size:1.25rem;text-align:center;
  text-shadow:0 0 8px rgba(255,255,255,.3);
}
.rank:nth-of-type(1){color:#ffd700;font-size:1.4rem;text-shadow:0 0 16px #ffd700;}
.rank:nth-of-type(2){color:#c0c0c0;font-size:1.35rem;text-shadow:0 0 14px #c0c0c0;}
.rank:nth-of-type(3){color:#cd7f32;font-size:1.3rem;text-shadow:0 0 12px #cd7f32;}

/* Player Name */
.name{display:flex;align-items:center;gap:12px;font-size:.95rem}
.avatar{
  width:36px;height:36px;border-radius:10px;overflow:hidden;
  box-shadow:0 0 12px rgba(0,0,0,.4),0 0 0 1px rgba(255,255,255,.1);
  flex-shrink:0;
}
.avatar img{width:100%;height:100%;object-fit:cover}

/* Discord Tag */
.discord-tag{
  display:flex;align-items:center;gap:6px;font-size:.78rem;color:var(--discord);
  font-weight:500;opacity:0.9;
}
.discord-tag i{
  filter:drop-shadow(0 0 4px var(--glow));
  animation:discordPulse 2.5s infinite alternate;
}
@keyframes discordPulse{
  from{filter:drop-shadow(0 0 4px var(--glow));}
  to{filter:drop-shadow(0 0 9px var(--glow));}
}

/* Empty Slot */
.empty-slot{color:#666;font-style:italic;font-size:.9rem}

/* ────────────────────────────────── LOADER ────────────────────────────────── */
#loader{
  position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;
  align-items:center;justify-content:center;transition:opacity .8s ease;z-index:10;
  cursor:pointer;
}
#logo{
  font-size:3rem;font-weight:900;text-transform:uppercase;color:var(--accent);
  letter-spacing:4px;animation:glow 2s infinite alternate;
  background:linear-gradient(45deg,#fff,#aaa);background-clip:text;
  -webkit-background-clip:text;color:transparent;
}
@keyframes glow{
  from{ text-shadow:0 0 12px var(--accent); opacity:.85 }
  to{   text-shadow:0 0 40px var(--accent),0 0 80px var(--accent); opacity:1 }
}

/* ────────────────────────────────── EDITOR MODAL ────────────────────────────────── */
#editor-modal{
  position:fixed;inset:0;background:rgba(0,0,0,.9);display:flex;align-items:center;
  justify-content:center;z-index:20;opacity:0;pointer-events:none;transition:opacity .3s;
}
#editor-modal.show{opacity:1;pointer-events:auto}
#editor-box{
  background:var(--glass);padding:28px;border-radius:16px;width:92%;max-width:660px;
  box-shadow:0 0 60px rgba(0,0,0,.8);border:1px solid var(--glass-border);
  backdrop-filter:blur(12px);
}
#json-editor{
  width:100%;height:360px;background:#0a0a0a;color:#0f0;font-family:monospace;
  padding:14px;border-radius:10px;border:1px solid #333;resize:none;
  font-size:.94rem;line-height:1.5;
}
.modal-btn{
  margin-top:14px;padding:11px 20px;background:var(--accent);color:#000;
  border:none;border-radius:10px;font-weight:600;cursor:pointer;transition:.25s;
}
.modal-btn:hover{background:#e0e0e0;transform:translateY(-1px)}
#save-msg{margin-top:10px;font-size:.88rem}

/* ────────────────────────────────── EDIT BUTTON ────────────────────────────────── */
#edit-btn{
  position:absolute;top:20px;right:20px;background:var(--accent);color:#000;
  padding:8px 16px;border-radius:9px;font-size:.82rem;font-weight:600;
  cursor:pointer;transition:.25s;box-shadow:0 2px 8px rgba(0,0,0,.3);
  border:1px solid rgba(0,0,0,.1);
}
#edit-btn:hover{background:#ddd;transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.4)}

/* ────────────────────────────────── FOOTER ────────────────────────────────── */
.last-updated{font-size:.76rem;color:var(--muted);text-align:center;margin:14px 0 8px}
footer{margin-top:8px;text-align:center;font-size:.76rem;color:var(--muted)}
footer a{color:var(--muted);text-decoration:none;transition:.2s}
footer a:hover{color:#ccc;text-decoration:underline}

/* ────────────────────────────────── RESPONSIVE ────────────────────────────────── */
@media (max-width:600px){
  #app{padding:18px}
  h1{font-size:1.9rem}
  .name{gap:10px;font-size:.9rem}
  .avatar{width:32px;height:32px}
  .table-container{max-height:60vh}
  th,td{padding:8px 10px}
  #edit-btn{top:16px;right:16px;padding:7px 12px;font-size:.78rem}
}
</style>
</head>
<body>

<!-- LOADER -->
<div id="loader" tabindex="0" role="button" aria-label="Enter leaderboard">
  <div id="logo">GOONING</div>
  <div style="margin-top:16px;color:#888;font-size:1.1rem;">Click or press Enter</div>
</div>

<!-- MAIN APP -->
<div id="app" class="hidden">
  <button id="edit-btn">Edit JSON</button>
  <h1>Gooning Leaderboard</h1>

  <div id="loading" style="text-align:center;color:#bbb;margin:20px 0;font-size:.95rem;">Loading leaderboard...</div>

  <div class="table-container">
    <table id="board" class="hidden">
      <thead><tr><th style="width:60px">Rank</th><th>Player</th></tr></thead>
      <tbody id="rows"></tbody>
    </table>
  </div>

  <div class="last-updated" id="updated"></div>
  <footer>Auto-refreshed • <a href="leaderboard.json" target="_blank">view raw JSON</a></footer>
</div>

<!-- EDITOR MODAL -->
<div id="editor-modal">
  <div id="editor-box">
    <h3 style="margin-bottom:14px;color:#fff;font-weight:600;">Edit Leaderboard JSON</h3>
    <textarea id="json-editor" spellcheck="false" placeholder="Paste valid JSON here..."></textarea>
    <button class="modal-btn" id="save-btn">Save & Update</button>
    <button class="modal-btn" id="cancel-btn" style="background:#666;margin-left:10px;">Cancel</button>
    <div id="save-msg"></div>
  </div>
</div>

<script>
const $ = id => document.getElementById(id);

// ────── DISCORD PFP HELPER ──────
function getDiscordAvatar(userId, avatarHash, size = 64) {
  if (!userId || !avatarHash) return `https://cdn.discordapp.com/embed/avatars/0.png`;
  const ext = avatarHash.startsWith('a_') ? 'gif' : 'webp';
  return `https://cdn.discordapp.com/avatars/${userId}/${avatarHash}.${ext}?size=${size}`;
}

// ────── LOADER ──────
function enterLeaderboard() {
  const loader = $('loader');
  loader.style.opacity = '0';
  setTimeout(() => {
    loader.classList.add('hidden');
    $('app').classList.remove('hidden');
    fetchLeaderboard();
    setInterval(fetchLeaderboard, 30000);
  }, 800);
}
$('loader').addEventListener('click', enterLeaderboard);
$('loader').addEventListener('keydown', e => {
  if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); enterLeaderboard(); }
});
setTimeout(() => $('loader').focus(), 100);

// ────── FETCH LEADERBOARD ──────
async function fetchLeaderboard() {
  const loading = $('loading');
  const board   = $('board');
  const rows    = $('rows');
  const updated = $('updated');

  try {
    const res = await fetch('leaderboard.json?' + Date.now());
    if (!res.ok) throw new Error('Not found');
    const data = await res.json();

    let list = Array.isArray(data) ? data : (data.leaderboard || []);
    const time = data.updated || new Date().toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'});

    // Pad to 100 slots
    const paddedList = [];
    for (let i = 0; i < 100; i++) {
      paddedList.push(list[i] || { rank: i + 1 });
    }

    rows.innerHTML = paddedList.map((p, idx) => {
      const hasData = p.name || p.discord;
      const avatarUrl = getDiscordAvatar(p.discordId, p.avatar);
      const rank = p.rank || (idx + 1);
      return `
        <tr>
          <td class="rank">${rank}</td>
          <td class="name">
            ${hasData ? `
            <div class="avatar">
              <img src="${avatarUrl}"
                   onerror="this.src='https://cdn.discordapp.com/embed/avatars/0.png'"
                   alt="${e(p.name || 'User')} avatar">
            </div>
            <div>
              <div style="font-weight:600;font-size:.96rem">${e(p.name || 'Unknown')}</div>
              ${p.discord ? `<div class="discord-tag"><i class="fab fa-discord"></i>${e(p.discord)}</div>` : ''}
            </div>
            ` : `<div class="empty-slot">— Empty Slot —</div>`}
          </td>
        </tr>`;
    }).join('');

    updated.textContent = `Last updated: ${time}`;
    loading.classList.add('hidden');
    board.classList.remove('hidden');
  } catch (err) {
    loading.textContent = 'Failed to load leaderboard.';
    loading.style.color = '#f88';
  }
}

// ────── EDITOR MODAL ──────
const modal = $('editor-modal');
const jsonEditor = $('json-editor');

$('edit-btn').onclick = async () => {
  try {
    const res = await fetch('leaderboard.json');
    const txt = await res.text();
    jsonEditor.value = txt.trim() || '[]';
    modal.classList.add('show');
  } catch (e) {
    alert('Could not read JSON file.');
  }
};

$('cancel-btn').onclick = () => modal.classList.remove('show');

$('save-btn').onclick = async () => {
  const msg = $('save-msg');
  let obj;
  try { obj = JSON.parse(jsonEditor.value); } catch (e) {
    msg.textContent = 'Invalid JSON format'; msg.style.color = '#f66'; return;
  }

  msg.textContent = 'Saving is disabled. Run a backend server (Node.js/PHP) to enable editing.';
  msg.style.color = '#ff9800';
};

// ────── ESCAPE HTML ──────
function e(t) {
  const d = document.createElement('div');
  d.textContent = t;
  return d.innerHTML;
}
</script>
</body>
</html>
