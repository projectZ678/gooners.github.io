<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gooning Hub</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet"/>
  <style>
    :root{
      --bg:#000;--glass:#111111ee;--glass-border:rgba(255,255,255,.1);
      --text:#fff;--muted:#aaa;--accent:#fff;--glow:#ff1a75;--goon-glow:#ff66b3;
      font-family:'Inter',system-ui,sans-serif;
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;outline:none;user-select:none;}
    html,body{min-height:100vh;background:var(--bg);overflow:hidden;color:var(--text);display:flex;}
    .stars{position:fixed;inset:0;pointer-events:none;z-index:0;}
    .star{position:absolute;background:#fff;border-radius:50%;opacity:0;animation:fall linear infinite;}
    @keyframes fall{0%{transform:translateY(-100px) scale(.2);opacity:0;}10%{opacity:1;}90%{opacity:.3;}100%{transform:translateY(100vh) scale(.8);opacity:0;}}
    #app{display:flex;height:100vh;width:100vw;position:relative;z-index:1;}

    /* SIDEBAR */
    #sidebar{width:280px;background:var(--glass);border-right:1px solid var(--glass-border);
      backdrop-filter:blur(20px);padding:40px 24px;display:flex;flex-direction:column;align-items:center;
      box-shadow:0 0 60px rgba(255,255,255,.12);flex-shrink:0;}
    #pfp{width:130px;height:130px;border-radius:50%;overflow:hidden;margin-bottom:24px;
      border:3px solid var(--glow);box-shadow:0 0 40px var(--glow),0 0 80px rgba(255,255,255,.3);
      animation:pulsePfp 3s infinite alternate;}
    @keyframes pulsePfp{0%{box-shadow:0 0 40px var(--glow),0 0 80px rgba(255,255,255,.3);}
      100%{box-shadow:0 0 60px var(--glow),0 0 120px rgba(255,255,255,.4);}}
    #pfp img{width:100%;height:100%;object-fit:cover;}
    .sidebar-title{font-size:1.8rem;font-weight:800;letter-spacing:4px;color:var(--accent);
      margin-bottom:32px;text-shadow:0 0 20px var(--goon-glow);}
    .nav-btn{display:flex;align-items:center;gap:14px;width:100%;padding:14px 18px;
      background:rgba(255,255,255,.08);border:1px solid var(--glass-border);border-radius:14px;
      font-weight:600;cursor:pointer;transition:.3s;color:var(--text);margin-bottom:10px;
      backdrop-filter:blur(8px);}
    .nav-btn:hover{background:rgba(255,255,255,.16);transform:translateX(6px);
      box-shadow:0 0 30px var(--goon-glow);}
    .nav-btn.active{background:rgba(255,255,255,.22);border-color:var(--glow);color:var(--glow);
      box-shadow:0 0 40px var(--goon-glow);}
    .socials{margin-top:auto;display:flex;gap:16px;}
    .social-icon{width:48px;height:48px;border-radius:14px;display:flex;align-items:center;
      justify-content:center;font-size:1.5rem;transition:.4s;cursor:pointer;
      background:rgba(255,255,255,.1);border:1px solid var(--glass-border);color:var(--accent);}
    .social-icon:hover{transform:scale(1.2);box-shadow:0 0 30px var(--goon-glow);}

    /* MAIN */
    #main{flex:1;display:flex;flex-direction:column;overflow:hidden;background:rgba(0,0,0,.4);
      backdrop-filter:blur(12px);padding:40px;}
    h1{font-weight:800;font-size:3rem;letter-spacing:5px;color:var(--accent);
      text-shadow:0 0 50px var(--goon-glow);margin-bottom:28px;text-align:center;
      animation:titleGlow 3s ease-in-out infinite alternate;}
    @keyframes titleGlow{0%{text-shadow:0 0 40px var(--goon-glow);}
      100%{text-shadow:0 0 80px var(--goon-glow),0 0 140px #ff99cc;}}

    .panel{display:none;flex:1;flex-direction:column;}
    .panel.active{display:flex;}

    /* GOON CLICKER */
    .clicker-panel{display:flex;flex-direction:column;align-items:center;gap:20px;position:relative;}

    /* GOONER CHARACTER */
    #gooner-container{
      width:320px;height:420px;position:relative;cursor:pointer;
      filter:drop-shadow(0 0 30px var(--goon-glow));
    }
    #gooner-body{
      width:100%;height:100%;background:radial-gradient(ellipse at bottom,#333,#111);
      border-radius:50% 50% 40% 40%/60% 60% 40% 40%;position:relative;overflow:hidden;
      border:3px solid #444;box-shadow:inset 0 0 40px rgba(0,0,0,.8);
    }
    #gooner-head{
      width:140px;height:160px;background:#f8d8c0;border-radius:50%;position:absolute;
      top:40px;left:50%;transform:translateX(-50%);border:3px solid #444;
      box-shadow:0 0 20px rgba(255,255,255,.2);
    }
    .eye{
      width:28px;height:36px;background:#fff;border-radius:50%;position:absolute;top:50px;
      box-shadow:inset 0 0 10px #000;animation:blink 4s infinite;
    }
    .eye.left{left:40px;}
    .eye.right{right:40px;}
    .pupil{
      width:14px;height:14px;background:#000;border-radius:50%;position:absolute;
      top:10px;left:50%;transform:translateX(-50%);
    }
    @keyframes blink{
      0%,95%{height:36px;} 97%,100%{height:4px;}
    }
    #gooner-arm{
      width:60px;height:180px;background:#f8d8c0;border-radius:30px;position:absolute;
      bottom:80px;right:60px;transform-origin:bottom right;transform:rotate(-20deg);
      border:3px solid #444;box-shadow:0 0 15px rgba(0,0,0,.5);
      transition:transform .1s ease-out;z-index:10;
    }
    #gooner-hand{
      width:50px;height:50px;background:#f8d8c0;border-radius:50%;position:absolute;
      bottom:-25px;right:-25px;border:3px solid #444;
      box-shadow:0 0 15px rgba(0,0,0,.5);
    }
    .hand-glow{
      position:absolute;inset:-10px;border-radius:50%;background:rgba(255,102,179,.4);
      filter:blur(15px);opacity:0;transition:opacity .2s;
    }

    /* GOON METER */
    #goon-meter-container{
      width:300px;height:20px;background:rgba(255,255,255,.1);border:2px solid var(--glass-border);
      border-radius:10px;overflow:hidden;margin-top:10px;position:relative;
    }
    #goon-meter{
      height:100%;width:0%;background:linear-gradient(90deg,#ff66b3,#ff1a75);
      transition:width .3s ease;box-shadow:0 0 20px #ff66b3;
    }
    #goon-meter-label{
      position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
      font-size:.9rem;font-weight:600;color:#fff;text-shadow:0 0 10px #000;
    }

    /* STATS */
    #points{font-size:3.2rem;font-weight:800;color:#fff;text-shadow:0 0 30px #ff66b3;}
    #gps{font-size:1.4rem;color:#ff99cc;margin-top:5px;}
    #shards{font-size:1.3rem;color:#ffd700;margin-top:5px;}

    .upgrades-grid{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(210px,1fr));gap:16px;width:100%;max-width:1000px;
      margin-top:20px;
    }
    .upgrade{
      background:rgba(255,255,255,.08);border:1px solid var(--glass-border);border-radius:16px;
      padding:16px;text-align:center;transition:.3s;cursor:pointer;position:relative;overflow:hidden;
    }
    .upgrade:hover{
      background:rgba(255,255,255,.15);transform:translateY(-4px);box-shadow:0 0 30px var(--goon-glow);
    }
    .upgrade.maxed{opacity:0.5;pointer-events:none;}
    .upgrade-name{font-weight:700;color:#fff;}
    .upgrade-cost{font-size:0.9rem;color:#ccc;margin-top:4px;}
    .upgrade-effect{font-size:0.8rem;color:#ff99cc;margin-top:8px;}
    .upgrade-icon{font-size:1.8rem;margin-bottom:8px;filter:drop-shadow(0 0 10px var(--goon-glow));}

    .prestige-btn{
      margin-top:30px;padding:16px 40px;background:#fff;color:#000;border:none;
      border-radius:16px;font-weight:800;cursor:pointer;transition:.4s;
      box-shadow:0 0 40px #fff;animation:pulseBtn 2s infinite;
    }
    .prestige-btn:hover{transform:scale(1.1);box-shadow:0 0 80px #fff;}
    @keyframes pulseBtn{0%,100%{box-shadow:0 0 40px #fff;}50%{box-shadow:0 0 80px #fff;}}

    /* BADGES */
    .badges-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:12px;}
    .badge{
      aspect-ratio:1;background:rgba(255,255,255,.1);border:2px solid transparent;
      border-radius:12px;display:flex;flex-direction:column;align-items:center;justify-content:center;
      font-size:1.6rem;transition:.3s;cursor:default;
    }
    .badge.unlocked{border-color:#0f0;box-shadow:0 0 20px #0f0;animation:pop 0.5s;}
    .badge.locked{opacity:0.3;color:#555;}
    .badge-name{font-size:0.65rem;margin-top:4px;opacity:0.8;}

    /* ACHIEVEMENT */
    .achievement{
      position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
      background:#fff;color:#000;padding:14px 32px;border-radius:16px;font-weight:800;
      box-shadow:0 0 40px #fff;z-index:1000;animation:pop 0.5s ease-out;opacity:0;
      display:flex;align-items:center;gap:12px;font-size:1.1rem;
    }
    @keyframes pop{0%{transform:translateX(-50%) scale(0);opacity:0;}100%{transform:translateX(-50%) scale(1);opacity:1;}}

    /* PARTICLES */
    @keyframes sweat{0%{transform:translateY(0) rotate(0);opacity:1;}100%{transform:translateY(-100px) rotate(20deg);opacity:0;}}
    @keyframes heart{0%{transform:scale(0) translateY(0);opacity:1;}100%{transform:scale(1.5) translateY(-80px);opacity:0;}}
    @keyframes goonBurst{0%{transform:scale(1);opacity:1;filter:blur(0);}100%{transform:scale(4);opacity:0;filter:blur(20px);}}

    /* LOADER */
    #loader{position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;
      align-items:center;justify-content:center;z-index:100;cursor:pointer;transition:opacity 1s ease;}
    #logo{font-size:6rem;font-weight:900;color:var(--accent);text-shadow:0 0 30px #ff66b3;
      animation:glow 2.5s infinite alternate;}
    @keyframes glow{from{text-shadow:0 0 30px #ff66b3;}to{text-shadow:0 0 80px #ff66b3,0 0 160px #ff99cc;}}
    .hidden{display:none!important;}
  </style>
</head>
<body>
  <div class="stars" id="stars"></div>

  <!-- LOADER -->
  <div id="loader" tabindex="0" role="button" aria-label="Enter Hub">
    <div id="logo">GOONING</div>
    <div style="margin-top:22px;color:#aaa;font-size:1.3rem;">Click to Enter the Goon Zone</div>
  </div>

  <div id="app" class="hidden">
    <!-- SIDEBAR -->
    <div id="sidebar">
      <div id="pfp">
        <img src="https://i.pinimg.com/1200x/65/ce/74/65ce749c9a83c75ee8f49bd698097a09.jpg" alt="PFP">
      </div>
      <div class="sidebar-title">GOONING</div>
      <div class="nav-btn active" data-panel="clicker">GOON CLICKER</div>
      <div class="nav-btn" data-panel="badges">BADGES</div>
      <div class="nav-btn" data-panel="home">Leaderboard</div>
      <div class="nav-btn" data-panel="promo">Vault 13</div>
      <div class="nav-btn" data-panel="credits">Credits</div>
      <div class="socials">
        <a href="https://github.com/projectZ678" target="_blank" class="social-icon"><i class="fab fa-github"></i></a>
      </div>
    </div>

    <!-- MAIN -->
    <div id="main">
      <!-- GOON CLICKER -->
      <div id="clicker" class="panel active">
        <h1>GOON CLICKER</h1>
        <div class="clicker-panel">
          <div id="points">0</div>
          <div id="gps">0 GPS</div>
          <div id="shards">0 Shards</div>

          <!-- GOON METER -->
          <div id="goon-meter-container">
            <div id="goon-meter"></div>
            <div id="goon-meter-label">GOON METER: 0%</div>
          </div>

          <!-- GOONER CHARACTER -->
          <div id="gooner-container">
            <div id="gooner-body">
              <div id="gooner-head">
                <div class="eye left"><div class="pupil"></div></div>
                <div class="eye right"><div class="pupil"></div></div>
              </div>
              <div id="gooner-arm">
                <div id="gooner-hand">
                  <div class="hand-glow"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="upgrades-grid" id="upgrades"></div>
          <button class="prestige-btn" id="prestige">PRESTIGE FOR SHARDS</button>
        </div>
      </div>

      <!-- BADGES -->
      <div id="badges" class="panel">
        <h1>GOON BADGES</h1>
        <div class="badges-grid" id="badgeContainer"></div>
      </div>

      <!-- LEADERBOARD (unchanged) -->
      <div id="home" class="panel">
        <h1>Gooning Leaderboard</h1>
        <div class="zoom-controls">
          <button id="zoomOut">-</button>
          <span id="zoomPercent">50%</span>
          <button id="zoomIn">+</button>
          <button id="zoomReset">Reset</button>
        </div>
        <div id="loading" style="text-align:center;color:#bbb;margin:32px 0;">Loading...</div>
        <div id="error" class="hidden" style="color:#f88;text-align:center;padding:40px;">
          Failed to load leaderboard.<br>
          <button class="retry-btn" onclick="fetchLeaderboard()">Retry</button>
        </div>
        <div class="table-container">
          <table id="board" class="hidden">
            <thead><tr><th>Rank</th><th>Player</th></tr></thead>
            <tbody id="rows"></tbody>
          </table>
        </div>
        <div class="last-updated" id="updated"></div>
      </div>

      <!-- PROMO & CREDITS (unchanged) -->
      <div id="promo" class="panel">
        <div style="text-align:center;max-width:600px;margin:0 auto;">
          <h1>VAULT 13</h1>
          <p style="font-size:1.3rem;line-height:1.7;margin:20px 0;">
            The ultimate gooning sanctuary. Join the elite. Enter the vault.
          </p>
          <a href="https://vault13.lol" target="_blank">
            <button style="padding:18px 48px;background:#fff;color:#000;border:none;border-radius:16px;font-weight:700;font-size:1.2rem;cursor:pointer;margin:10px;">
              Visit vault13.lol
            </button>
          </a>
        </div>
      </div>

      <div id="credits" class="panel">
        <div style="text-align:center;">
          <h2>Made with love by <span style="color:#fff">Xen</span></h2>
          <p>Design â€¢ Code â€¢ Goon Dreams</p>
          <p><a href="https://github.com/projectZ678" target="_blank" style="color:#ccc;">github.com/projectZ678</a></p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    const stars = $('#stars');
    let starCnt = 0;

    function addStar(){
      if(starCnt>120) return;
      const s=document.createElement('div'); s.className='star';
      const sz = Math.random()*2.5+0.8;
      s.style.width=s.style.height=`${sz}px`;
      s.style.left=`${Math.random()*100}vw`;
      s.style.animationDuration=`${Math.random()*6+4}s`;
      s.style.animationDelay=`${Math.random()*3}s`;
      stars.appendChild(s); starCnt++;
      setTimeout(()=>{s.remove();starCnt--;},10000);
    }
    setInterval(addStar,250);

    function enterHub(){
      const loader = $('loader');
      loader.style.opacity = '0';
      setTimeout(() => {
        loader.classList.add('hidden');
        $('app').classList.remove('hidden');
        initClicker();
        fetchLeaderboard();
        setInterval(fetchLeaderboard, 60000);
      }, 800);
    }
    $('loader').addEventListener('click', enterHub);
    $('loader').addEventListener('keydown', e => {
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); enterHub(); }
    });
    $('loader').focus();

    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        btn.classList.add('active');
        $(btn.dataset.panel).classList.add('active');
        if(btn.dataset.panel === 'badges') renderBadges();
      });
    });

    // ==============================================================
    // ===================== GOON CLICKER CORE ======================
    // ==============================================================

    let points = 0, gps = 0, clickPower = 1, prestige = 1, shards = 0;
    let goonMeter = 0, maxGoonMeter = 100;
    const MAX_OWNED = 25;

    const upgrades = [
      {id:'lube',name:'Lube Dispenser',icon:'',base:50,exp:1.5,effect:0.2,owned:0,type:'gps'},
      {id:'vr',name:'VR Headset',icon:'VR',base:300,exp:1.55,effect:1,owned:0,type:'gps'},
      {id:'edging',name:'Edging Timer',icon:'Timer',base:1000,exp:1.6,effect:5,owned:0,type:'gps'},
      {id:'cave',name:'Goon Cave',icon:'Cave',base:5000,exp:1.65,effect:20,owned:0,type:'gps'},
      {id:'stroker',name:'Auto-Stroker',icon:'Robot Arm',base:15000,exp:1.7,effect:50,owned:0,type:'gps'},
      {id:'click1',name:'Grip Strength',icon:'Hand',base:100,exp:1.5,effect:1,owned:0,type:'click'},
      {id:'click2',name:'Frenzy Mode',icon:'Lightning',base:1000,exp:1.55,effect:5,owned:0,type:'click'},
      {id:'click3',name:'Goon Rage',icon:'Fire',base:10000,exp:1.6,effect:25,owned:0,type:'click'},
      {id:'mult1',name:'Pink Lighting',icon:'Lightbulb',base:2000,exp:1.7,effect:0.1,owned:0,type:'mult'},
      {id:'mult2',name:'Goon Music',icon:'Headphones',base:8000,exp:1.75,effect:0.2,owned:0,type:'mult'},
    ];

    const badges = [
      {id:'first',icon:'Hand',name:'First Stroke',cond:()=>points>=1},
      {id:'hundred',icon:'100',name:'100 Strokes',cond:()=>points>=100},
      {id:'thousand',icon:'1K',name:'1K Goon',cond:()=>points>=1000},
      {id:'burst',icon:'Explosion',name:'First Burst',cond:()=>localStorage.getItem('burst')},
      {id:'prestige',icon:'Star',name:'First Prestige',cond:()=>prestige>=2},
      {id:'shard',icon:'Gem',name:'Shard Lord',cond:()=>shards>=10},
    ];

    function initClicker(){
      loadGame();
      renderUpgrades();
      updateDisplay();
      setInterval(autoEarn, 1000);
      setInterval(saveGame, 5000);
      setInterval(updateGoonMeter, 100);
      setInterval(checkBadges, 1000);

      const hand = $('#gooner-hand');
      hand.addEventListener('mousedown', goonClick);
      hand.addEventListener('touchstart', e => { e.preventDefault(); goonClick(); });
    }

    function goonClick(){
      const earned = clickPower * prestige;
      points += earned;
      goonMeter = Math.min(goonMeter + 10, maxGoonMeter);
      animateArm();
      createSweat();
      createHearts();
      screenShake();
      updateDisplay();
      checkGoonBurst();
    }

    function autoEarn(){
      const earned = gps * prestige;
      points += earned;
      goonMeter = Math.min(goonMeter + gps * 0.5, maxGoonMeter);
      updateDisplay();
      checkGoonBurst();
    }

    function checkGoonBurst(){
      if (goonMeter >= maxGoonMeter){
        const burst = Math.floor(points * 0.1) + 100;
        points += burst;
        goonMeter = 0;
        showAchievement(`GOON BURST! +${burst.toLocaleString()}`);
        goonBurstEffect();
        localStorage.setItem('burst','1');
      }
    }

    function updateGoonMeter(){
      const percent = (goonMeter / maxGoonMeter) * 100;
      $('goon-meter').style.width = percent + '%';
      $('goon-meter-label').textContent = `GOON METER: ${Math.floor(percent)}%`;
    }

    function animateArm(){
      const arm = $('#gooner-arm');
      const hand = $('#gooner-hand');
      const glow = hand.querySelector('.hand-glow');
      arm.style.transform = 'rotate(-50deg)';
      glow.style.opacity = '1';
      setTimeout(() => {
        arm.style.transform = 'rotate(-20deg)';
        glow.style.opacity = '0';
      }, 150);
    }

    function createSweat(){
      for(let i=0;i<3;i++){
        const s = document.createElement('div');
        s.textContent = 'ðŸ’§';
        s.style.cssText = `
          position:fixed;pointer-events:none;font-size:1.5rem;
          left:${55 + Math.random()*10}%;top:45%;animation:sweat .8s forwards;
          transform:rotate(${Math.random()*360}deg);
        `;
        document.body.appendChild(s);
        setTimeout(() => s.remove(), 800);
      }
    }

    function createHearts(){
      for(let i=0;i<5;i++){
        const h = document.createElement('div');
        h.textContent = 'Heart';
        h.style.cssText = `
          position:fixed;pointer-events:none;font-size:1.8rem;
          left:${58 + Math.random()*8}%;top:40%;animation:heart 1s forwards;
          color:#ff66b3;
        `;
        document.body.appendChild(h);
        setTimeout(() => h.remove(), 1000);
      }
    }

    function goonBurstEffect(){
      const burst = document.createElement('div');
      burst.textContent = 'GOON BURST!';
      burst.style.cssText = `
        position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
        font-size:4rem;font-weight:900;color:#ff66b3;pointer-events:none;
        animation:goonBurst 1.5s forwards;z-index:100;
      `;
      document.body.appendChild(burst);
      setTimeout(() => burst.remove(), 1500);
    }

    function buyUpgrade(id){
      const u = upgrades.find(x => x.id === id);
      if (!u || u.owned >= MAX_OWNED || points < getCost(u)) return;
      points -= getCost(u);
      u.owned++;
      if (u.type==='gps') gps += u.effect;
      else if (u.type==='click') clickPower += u.effect;
      else if (u.type==='mult') prestige += u.effect;
      renderUpgrades();
      updateDisplay();
    }

    function getCost(u){
      return Math.floor(u.base * Math.pow(u.exp, u.owned));
    }

    function prestigeReset(){
      if (points < 50000) return;
      const gain = Math.floor(Math.sqrt(points / 1000));
      shards += gain;
      prestige *= 2;
      points = 0; gps = 0; clickPower = 1; goonMeter = 0;
      upgrades.forEach(u => u.owned = 0);
      renderUpgrades();
      updateDisplay();
      showAchievement(`PRESTIGED! +${gain} Shards | x${prestige} Multi`);
    }

    function renderUpgrades(){
      $('upgrades').innerHTML = upgrades.map(u => {
        const cost = getCost(u);
        return `
          <div class="upgrade ${u.owned>=MAX_OWNED?'maxed':''}" onclick="${u.owned>=MAX_OWNED?'':`buyUpgrade('${u.id}')`}">
            <div class="upgrade-icon">${u.icon}</div>
            <div class="upgrade-name">${u.name}</div>
            <div class="upgrade-cost">Cost: ${cost.toLocaleString()}</div>
            <div class="upgrade-effect">Owned: ${u.owned}/${MAX_OWNED}</div>
          </div>`;
      }).join('');
    }

    function updateDisplay(){
      $('points').textContent = Math.floor(points).toLocaleString();
      $('gps').textContent = `${gps.toFixed(1)} GPS`;
      $('shards').textContent = `${shards} Goon Shards`;
    }

    function showAchievement(text){
      const a = document.createElement('div');
      a.className = 'achievement';
      a.innerHTML = `<i class="fas fa-trophy"></i> ${text}`;
      document.body.appendChild(a);
      setTimeout(() => a.style.opacity = 1, 50);
      setTimeout(() => { a.style.opacity = 0; setTimeout(() => a.remove(), 500); }, 3000);
    }

    function checkBadges(){
      badges.forEach(b => {
        if (b.cond() && !localStorage.getItem('badge_'+b.id)){
          localStorage.setItem('badge_'+b.id,'1');
          showAchievement(`${b.icon} ${b.name} UNLOCKED`);
        }
      });
    }

    function renderBadges(){
      $('#badgeContainer').innerHTML = badges.map(b => {
        const unlocked = localStorage.getItem('badge_'+b.id);
        return `
          <div class="badge ${unlocked?'unlocked':'locked'}">
            <div>${b.icon}</div>
            <div class="badge-name">${b.name}</div>
          </div>`;
      }).join('');
    }

    function screenShake(){
      document.body.style.animation = 'shake 0.3s';
      setTimeout(() => document.body.style.animation = '', 300);
    }

    function saveGame(){
      const save = { points, gps, clickPower, prestige, shards, upgrades:upgrades.map(u=>({id:u.id,owned:u.owned})) };
      localStorage.setItem('goonSaveV3', JSON.stringify(save));
    }

    function loadGame(){
      const raw = localStorage.getItem('goonSaveV3') || localStorage.getItem('goonSaveV2') || localStorage.getItem('goonSave');
      if (!raw) return;
      const save = JSON.parse(raw);
      points = save.points ?? 0;
      gps = save.gps ?? 0;
      clickPower = save.clickPower ?? 1;
      prestige = save.prestige ?? 1;
      shards = save.shards ?? 0;
      (save.upgrades||[]).forEach(su => {
        const u = upgrades.find(x=>x.id===su.id);
        if(u) u.owned = su.owned??0;
      });
    }

    $('prestige').onclick = prestigeReset;

    // Leaderboard & Zoom (unchanged)
    async function fetchLeaderboard(){
      const loading = $('loading'), error = $('error'), board = $('board'), rows = $('rows'), updated = $('updated');
      loading.classList.remove('hidden');
      error.classList.add('hidden');
      board.classList.add('hidden');
      try {
        const r = await fetch('leaderboard.json?' + Date.now());
        if (!r.ok) throw new Error('HTTP ' + r.status);
        const data = await r.json();
        const list = Array.isArray(data) ? data : (data.leaderboard || []);
        const time = data.updated || new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        const padded = Array(100).fill().map((_, i) => list[i] || { rank: i + 1 });
        rows.innerHTML = padded.map((p, idx) => {
          const av = p.discordId && p.avatar
            ? `https://cdn.discordapp.com/avatars/${p.discordId}/${p.avatar}.${p.avatar.startsWith('a_') ? 'gif' : 'webp'}?size=80`
            : 'https://cdn.discordapp.com/embed/avatars/0.png';
          const rank = p.rank || idx + 1;
          return `<tr><td class="rank">${rank}</td><td class="name">
            ${p.name ? `<div class="avatar"><img src="${av}" onerror="this.src='https://cdn.discordapp.com/embed/avatars/0.png'"></div><div style="font-weight:600;">${e(p.name)}</div>`
            : `<div class="empty-slot">â€” Empty Slot â€”</div>`}
          </td></tr>`;
        }).join('');
        updated.textContent = `Last updated: ${time}`;
        loading.classList.add('hidden');
        board.classList.remove('hidden');
      } catch (err) {
        loading.classList.add('hidden');
        error.classList.remove('hidden');
      }
    }
    function e(t){const d=document.createElement('div');d.textContent=t;return d.innerHTML;}
    const board = $('board'); const zoomPercent = $('#zoomPercent'); let scale = 0.5;
    function updateZoom(){board.style.transform=`scale(${scale})`;zoomPercent.textContent=`${Math.round(scale*100)}%`;}
    $('#zoomIn').onclick=()=>{scale=Math.min(scale+0.1,2);updateZoom();};
    $('#zoomOut').onclick=()=>{scale=Math.max(scale-0.1,0.3);updateZoom();};
    $('#zoomReset').onclick=()=>{scale=0.5;updateZoom();};
    updateZoom();
  </script>
</body>
</html>
