<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gooning Hub</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet"/>
  <style>
    :root{
      --bg:#000;--glass:#111111ee;--glass-border:rgba(255,255,255,.1);
      --text:#fff;--muted:#aaa;--accent:#fff;--glow:#fff;
      font-family:'Inter',system-ui,sans-serif;
    }
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;outline:none;user-select:none;}
    html,body{min-height:100vh;background:var(--bg);overflow:hidden;color:var(--text);display:flex;}
    .stars{position:fixed;inset:0;pointer-events:none;z-index:0;}
    .star{position:absolute;background:#fff;border-radius:50%;opacity:0;animation:fall linear infinite;}
    @keyframes fall{0%{transform:translateY(-100px) scale(.2);opacity:0;}10%{opacity:1;}90%{opacity:.3;}100%{transform:translateY(100vh) scale(.8);opacity:0;}}
    #app{display:flex;height:100vh;width:100vw;position:relative;z-index:1;}

    /* LOGIN OVERLAY */
    #login-overlay{position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;
      align-items:center;justify-content:center;z-index:200;backdrop-filter:blur(20px);}
    #login-form{background:var(--glass);border:1px solid var(--glass-border);border-radius:24px;
      padding:40px 32px;text-align:center;box-shadow:0 0 60px var(--glow);max-width:400px;width:90%;}
    #login-form h2{font-size:2.5rem;font-weight:800;letter-spacing:3px;color:var(--accent);
      margin-bottom:20px;text-shadow:0 0 30px var(--glow);}
    #username-input{width:100%;padding:14px;border:1px solid var(--glass-border);border-radius:12px;
      background:rgba(255,255,255,.05);color:var(--text);font-size:1.1rem;text-align:center;
      margin-bottom:16px;backdrop-filter:blur(8px);}
    #username-input::placeholder{color:var(--muted);}
    #login-btn{padding:12px 32px;background:var(--glow);color:#000;border:none;border-radius:12px;
      font-weight:700;cursor:pointer;transition:.3s;font-size:1rem;}
    #login-btn:hover{transform:scale(1.05);box-shadow:0 0 40px var(--glow);}
    .hidden{display:none!important;}

    /* SIDEBAR */
    #sidebar{width:280px;background:var(--glass);border-right:1px solid var(--glass-border);
      backdrop-filter:blur(20px);padding:40px 24px;display:flex;flex-direction:column;align-items:center;
      box-shadow:0 0 60px rgba(255,255,255,.12);flex-shrink:0;}
    #pfp{width:130px;height:130px;border-radius:50%;overflow:hidden;margin-bottom:8px;
      border:3px solid var(--glow);box-shadow:0 0 40px var(--glow),0 0 80px rgba(255,255,255,.3);
      animation:pulsePfp 3s infinite alternate;}
    @keyframes pulsePfp{0%{box-shadow:0 0 40px var(--glow),0 0 80px rgba(255,255,255,.3);}
      100%{box-shadow:0 0 60px var(--glow),0 0 120px rgba(255,255,255,.4);}}
    #pfp img{width:100%;height:100%;object-fit:cover;}
    #username-display{font-weight:600;color:var(--accent);margin-bottom:16px;text-align:center;
      text-shadow:0 0 10px var(--glow);}
    .sidebar-title{font-size:1.8rem;font-weight:800;letter-spacing:4px;color:var(--accent);
      margin-bottom:32px;text-shadow:0 0 20px rgba(255,255,255,.6);}
    .nav-btn{display:flex;align-items:center;gap:14px;width:100%;padding:14px 18px;
      background:rgba(255,255,255,.08);border:1px solid var(--glass-border);border-radius:14px;
      font-weight:600;cursor:pointer;transition:.3s;color:var(--text);margin-bottom:10px;
      backdrop-filter:blur(8px);}
    .nav-btn:hover{background:rgba(255,255,255,.16);transform:translateX(6px);
      box-shadow:0 0 30px rgba(255,255,255,.25);}
    .nav-btn.active{background:rgba(255,255,255,.22);border-color:var(--glow);color:var(--glow);
      box-shadow:0 0 40px rgba(255,255,255,.35);}
    .socials{margin-top:auto;display:flex;gap:16px;}
    .social-icon{width:48px;height:48px;border-radius:14px;display:flex;align-items:center;
      justify-content:center;font-size:1.5rem;transition:.4s;cursor:pointer;position:relative;
      background:rgba(255,255,255,.1);border:1px solid var(--glass-border);color:var(--accent);}
    .social-icon:hover{transform:scale(1.2);box-shadow:0 0 30px rgba(255,255,255,.4);}

    /* MAIN */
    #main{flex:1;display:flex;flex-direction:column;overflow:hidden;background:rgba(0,0,0,.4);
      backdrop-filter:blur(12px);padding:40px;}
    h1{font-weight:800;font-size:3rem;letter-spacing:5px;color:var(--accent);
      text-shadow:0 0 50px rgba(255,255,255,.6);margin-bottom:28px;text-align:center;
      animation:titleGlow 3s ease-in-out infinite alternate;}
    @keyframes titleGlow{0%{text-shadow:0 0 40px rgba(255,255,255,.6);}
      100%{text-shadow:0 0 80px rgba(255,255,255,.8),0 0 140px rgba(255,255,255,.5);}}
    .panel{display:none;flex:1;flex-direction:column;}
    .panel.active{display:flex;}

    /* GOON CLICKER */
    .clicker-panel{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:30px;}
    #goon-btn{width:280px;height:280px;border-radius:50%;background:radial-gradient(circle,#fff,#aaa);
      border:4px solid #fff;box-shadow:0 0 60px #fff,inset 0 0 40px #ddd;
      cursor:pointer;transition:.2s;animation:pulse 2s infinite;font-size:2rem;color:#000;font-weight:900;
      display:flex;align-items:center;justify-content:center;text-align:center;padding:20px;}
    #goon-btn:active{transform:scale(0.9);box-shadow:0 0 100px #fff;}
    @keyframes pulse{0%,100%{box-shadow:0 0 60px #fff,inset 0 0 40px #ddd;}
      50%{box-shadow:0 0 100px #fff,inset 0 0 80px #ddd;}}
    #points{font-size:3.5rem;font-weight:800;color:#fff;text-shadow:0 0 30px #fff;}
    #gps{font-size:1.5rem;color:#aaa;margin-top:10px;}
    #total-goons{font-size:1.2rem;color:#ccc;margin-top:8px;}

    .upgrades-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px;width:100%;max-width:1000px;}
    .upgrade{background:rgba(255,255,255,.08);border:1px solid var(--glass-border);border-radius:16px;
      padding:18px;text-align:center;transition:.3s;cursor:pointer;position:relative;overflow:hidden;}
    .upgrade:hover{background:rgba(255,255,255,.15);transform:translateY(-4px);box-shadow:0 0 30px #fff;}
    .upgrade.bought{opacity:0.6;pointer-events:none;}
    .upgrade-name{font-weight:700;color:#fff;font-size:1.1rem;}
    .upgrade-cost{font-size:0.95rem;color:#ccc;margin-top:6px;}
    .upgrade-effect{font-size:0.85rem;color:#888;margin-top:8px;}
    .upgrade-level{position:absolute;top:8px;right:8px;background:#fff;color:#000;padding:2px 8px;
      border-radius:8px;font-size:0.7rem;font-weight:800;}

    .prestige-btn{margin-top:30px;padding:16px 40px;background:#fff;color:#000;border:none;
      border-radius:16px;font-weight:800;cursor:pointer;transition:.4s;box-shadow:0 0 40px #fff;}
    .prestige-btn:hover{transform:scale(1.1);box-shadow:0 0 80px #fff;}
    .prestige-btn:disabled{opacity:0.5;cursor:not-allowed;}

    /* LEADERBOARD */
    .zoom-controls{position:absolute;top:12px;right:12px;background:rgba(30,30,30,.9);border-radius:12px;
      padding:6px 12px;display:flex;gap:8px;align-items:center;font-size:.9rem;color:#ddd;}
    .zoom-controls button{background:rgba(255,255,255,.15);border:none;border-radius:8px;
      width:28px;height:28px;cursor:pointer;}
    .zoom-controls button:hover{background:rgba(255,255,255,.25);}

    .table-container{flex:1;width:100%;overflow-y:auto;border-radius:18px;
      border:1px solid var(--glass-border);background:rgba(0,0,0,.35);
      box-shadow:inset 0 10px 18px rgba(0,0,0,.6);}
    table{width:100%;border-collapse:collapse;}
    thead{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,rgba(20,20,20,.98),rgba(15,15,15,.95));
      backdrop-filter:blur(16px);text-transform:uppercase;font-size:.88rem;letter-spacing:2px;color:var(--muted);}
    th,td{padding:18px 24px;}
    th:first-child,td:first-child{width:80px;text-align:center;}
    tr:hover{background:rgba(255,255,255,.07);}
    .rank{font-weight:800;color:#fff;font-size:1.7rem;text-shadow:0 0 18px #fff;}
    .name{display:flex;align-items:center;gap:16px;}
    .avatar{width:48px;height:48px;border-radius:50%;overflow:hidden;
      box-shadow:0 0 20px rgba(0,0,0,.8),0 0 0 2px #fff;}
    .avatar img{width:100%;height:100%;object-fit:cover;}
    .empty-slot{color:#666;font-style:italic;}
    .total-goons{font-weight:600;color:#0f0;}

    .retry-btn{margin-top:16px;padding:12px 32px;background:#444;color:#fff;border:none;
      border-radius:12px;cursor:pointer;font-weight:600;transition:.3s;}
    .retry-btn:hover{background:#666;transform:scale(1.05);}

    /* ACHIEVEMENT */
    .achievement{position:fixed;top:20px;right:20px;background:#fff;color:#000;padding:16px 24px;
      border-radius:16px;font-weight:800;box-shadow:0 0 40px #fff;z-index:1000;
      animation:pop 0.5s ease-out;opacity:0;}
    @keyframes pop{0%{transform:scale(0);opacity:0;}100%{transform:scale(1);opacity:1;}}

    /* LOADER */
    #loader{position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;
      align-items:center;justify-content:center;z-index:100;cursor:pointer;transition:opacity 1s ease;}
    #logo{font-size:6rem;font-weight:900;color:var(--accent);text-shadow:0 0 30px #fff;
      animation:glow 2.5s infinite alternate;}
    @keyframes glow{from{text-shadow:0 0 30px #fff;}to{text-shadow:0 0 80px #fff,0 0 160px #fff;}}

    @keyframes shake{0%,100%{transform:translateX(0);}25%{transform:translateX(-10px);}75%{transform:translateX(10px);}}
    @keyframes particle{0%{transform:scale(1) translateY(0);opacity:1;}100%{transform:scale(0) translateY(-100px);opacity:0;}}
  </style>
</head>
<body>
  <div class="stars" id="stars"></div>

  <!-- LOGIN OVERLAY -->
  <div id="login-overlay">
    <div id="login-form">
      <h2>Enter the Goon Vault</h2>
      <input type="text" id="username-input" placeholder="Your Goon Name..." maxlength="20">
      <button id="login-btn">GOON IN</button>
    </div>
  </div>

  <!-- LOADER -->
  <div id="loader" class="hidden" tabindex="0" role="button" aria-label="Enter Hub">
    <div id="logo">GOONING</div>
    <div style="margin-top:22px;color:#aaa;font-size:1.3rem;">Click or press Enter</div>
  </div>

  <div id="app" class="hidden">
    <!-- SIDEBAR -->
    <div id="sidebar">
      <div id="pfp">
        <img src="https://i.pinimg.com/1200x/65/ce/74/65ce749c9a83c75ee8f49bd698097a09.jpg" alt="PFP">
      </div>
      <div id="username-display"></div>
      <div class="sidebar-title">GOONING</div>
      <div class="nav-btn active" data-panel="clicker">GOON CLICKER</div>
      <div class="nav-btn" data-panel="home">Leaderboard</div>
      <div class="nav-btn" data-panel="promo">Vault 13</div>
      <div class="nav-btn" data-panel="credits">Credits</div>
      <div class="socials">
        <a href="https://github.com/projectZ678" target="_blank" class="social-icon">GitHub</a>
      </div>
    </div>

    <!-- MAIN -->
    <div id="main">
      <!-- GOON CLICKER -->
      <div id="clicker" class="panel active">
        <h1>GOON CLICKER</h1>
        <div class="clicker-panel">
          <div id="points">0</div>
          <div id="gps">0 GPS</div>
          <div id="total-goons">Total Goons: 0</div>
          <div id="goon-btn">CLICK TO GOON</div>
          <div class="upgrades-grid" id="upgrades"></div>
          <button class="prestige-btn" id="prestige">PRESTIGE (x2 Multiplier)</button>
        </div>
      </div>

      <!-- LEADERBOARD -->
      <div id="home" class="panel">
        <h1>Gooning Leaderboard</h1>
        <div class="zoom-controls">
          <button id="zoomOut">-</button>
          <span id="zoomPercent">50%</span>
          <button id="zoomIn">+</button>
          <button id="zoomReset">Reset</button>
        </div>
        <div id="loading" style="text-align:center;color:#bbb;margin:32px 0;">Loading...</div>
        <div id="error" class="hidden" style="color:#f88;text-align:center;padding:40px;">
          Failed to load leaderboard.<br>
          <button class="retry-btn" onclick="fetchLeaderboard()">Retry</button>
        </div>
        <div class="table-container">
          <table id="board" class="hidden">
            <thead><tr><th>Rank</th><th>Player</th><th>Total Goons</th></tr></thead>
            <tbody id="rows"></tbody>
          </table>
        </div>
        <div class="last-updated" id="updated"></div>
      </div>

      <!-- PROMO -->
      <div id="promo" class="panel">
        <div style="text-align:center;max-width:600px;margin:0 auto;">
          <h1>VAULT 13</h1>
          <p style="font-size:1.3rem;line-height:1.7;margin:20px 0;">
            The ultimate gooning sanctuary. Join the elite. Enter the vault.
          </p>
          <a href="https://vault13.lol" target="_blank">
            <button style="padding:18px 48px;background:#fff;color:#000;border:none;border-radius:16px;font-weight:700;font-size:1.2rem;cursor:pointer;margin:10px;">
              Visit vault13.lol
            </button>
          </a>
        </div>
      </div>

      <!-- CREDITS -->
      <div id="credits" class="panel">
        <div style="text-align:center;">
          <h2>Made with love by <span style="color:#fff">Xen</span></h2>
          <p>Design • Code • Monochrome Dreams</p>
          <p><a href="https://github.com/projectZ678" target="_blank" style="color:#ccc;">github.com/projectZ678</a></p>
          <p style="margin-top:30px;font-size:.9rem;color:#888;">
            Auto-refreshed • <a href="users.json" target="_blank">view raw JSON</a>
          </p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    const stars = $('#stars');
    let starCnt = 0;

    function addStar(){
      if(starCnt>120) return;
      const s=document.createElement('div'); s.className='star';
      const sz = Math.random()*2.5+0.8;
      s.style.width=s.style.height=`${sz}px`;
      s.style.left=`${Math.random()*100}vw`;
      s.style.animationDuration=`${Math.random()*6+4}s`;
      s.style.animationDelay=`${Math.random()*3}s`;
      stars.appendChild(s); starCnt++;
      setTimeout(()=>{s.remove();starCnt--;},10000);
    }
    setInterval(addStar,250);

    // === LOGIN SYSTEM ===
    let currentUser = localStorage.getItem('goonUsername');
    const loginOverlay = $('#login-overlay');
    const loginInput = $('#username-input');
    const loginBtn = $('#login-btn');
    const usernameDisplay = $('#username-display');

    function showApp() {
      loginOverlay.classList.add('hidden');
      $('loader').classList.remove('hidden');
      setTimeout(enterHub, 500); // Delay for smooth transition
    }

    if (currentUser) {
      usernameDisplay.textContent = currentUser;
      loginOverlay.classList.add('hidden');
      $('loader').classList.remove('hidden');
      enterHub();
    } else {
      loginOverlay.classList.remove('hidden');
      loginInput.focus();
      loginBtn.onclick = () => {
        const username = loginInput.value.trim();
        if (username) {
          currentUser = username;
          localStorage.setItem('goonUsername', currentUser);
          usernameDisplay.textContent = currentUser;
          showApp();
        }
      };
      loginInput.onkeydown = (e) => {
        if (e.key === 'Enter') loginBtn.click();
      };
    }

    // === LOADER ===
    function enterHub(){
      const loader = $('loader');
      loader.style.opacity = '0';
      setTimeout(() => {
        loader.classList.add('hidden');
        $('app').classList.remove('hidden');
        initClicker();
        fetchLeaderboard();
        setInterval(fetchLeaderboard, 60000);
      }, 800);
    }

    const loader = $('loader');
    loader.addEventListener('click', enterHub);
    loader.addEventListener('keydown', e => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        enterHub();
      }
    });

    // Panel switching
    document.querySelectorAll('.nav-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        btn.classList.add('active');
        $(btn.dataset.panel).classList.add('active');
      });
    });

    // === GOON CLICKER ===
    let points = 0, gps = 0, clickPower = 1, prestige = 1, totalGoons = 0;
    let clickInterval = 1000; // ms per click (for 2x speed)
    let autoClickerActive = false;
    let submitInterval;

    const upgrades = [
      {id:'auto',name:'Auto-Gooner',cost:50,baseCost:50,effect:0.1,owned:0,type:'gps'},
      {id:'double',name:'Double Click',cost:200,baseCost:200,effect:1,owned:0,type:'click'},
      {id:'speed',name:'2x Goon Speed',cost:800,baseCost:800,effect:0.5,owned:0,type:'speed'},
      {id:'neon',name:'Neon Boost',cost:2000,baseCost:2000,effect:2,owned:0,type:'gps'},
      {id:'vault',name:'Vault Pass',cost:10000,baseCost:10000,effect:0.5,owned:0,type:'prestige'},
      {id:'mega',name:'Mega Click',cost:50000,baseCost:50000,effect:10,owned:0,type:'click'},
      {id:'hyper',name:'Hyper GPS',cost:100000,baseCost:100000,effect:10,owned:0,type:'gps'},
      {id:'god',name:'God Mode',cost:500000,baseCost:500000,effect:5,owned:0,type:'multi'}
    ];

    function initClicker(){
      loadGame();
      renderUpgrades();
      updateDisplay();
      setInterval(autoEarn, 100);
      setInterval(saveGame, 5000);
      submitInterval = setInterval(() => {
        if (totalGoons > 100) submitToLeaderboard();
      }, 10000); // Auto-submit every 10s
      if (autoClickerActive) startAutoClicker();
    }

    function gainGoons(amount) {
      const earned = amount * prestige;
      points += earned;
      totalGoons += earned;
      updateDisplay();
      checkAchievements();
    }

    $('goon-btn').onclick = () => {
      gainGoons(clickPower);
      createParticles();
      screenShake();
    };

    function autoEarn(){
      if (gps > 0) gainGoons(gps / 10);
    }

    function startAutoClicker() {
      if (autoClickerActive) return;
      autoClickerActive = true;
      setInterval(() => {
        if (document.visibilityState === 'visible') {
          gainGoons(clickPower);
          createParticles(6);
        }
      }, clickInterval);
    }

    function buyUpgrade(id){
      const u = upgrades.find(x => x.id === id);
      if (!u || points < u.cost || u.owned >= 50) return;

      points -= u.cost;
      u.owned++;
      u.cost = Math.floor(u.baseCost * Math.pow(1.5, u.owned));

      if (u.type === 'gps') gps += u.effect;
      if (u.type === 'click') clickPower += u.effect;
      if (u.type === 'speed') clickInterval = Math.max(200, clickInterval * (1 - u.effect));
      if (u.type === 'prestige') prestige += u.effect;
      if (u.type === 'multi') { clickPower *= (1 + u.effect); gps *= (1 + u.effect); }

      if (u.id === 'auto' && u.owned === 1) startAutoClicker();

      renderUpgrades();
      updateDisplay();
    }

    function prestigeReset(){
      if (totalGoons < 50000) return showAchievement("Need 50K Total Goons to Prestige!");
      prestige *= 2;
      points = 0; gps = 0; clickPower = 1; clickInterval = 1000;
      totalGoons = Math.floor(totalGoons * 0.1); // Keep 10%
      upgrades.forEach(u => { u.owned = 0; u.cost = u.baseCost; });
      autoClickerActive = false;
      renderUpgrades();
      updateDisplay();
      showAchievement(`PRESTIGED! x${prestige} Multiplier Unlocked`);
      submitToLeaderboard(); // Submit after prestige
    }

    function renderUpgrades(){
      $('upgrades').innerHTML = upgrades.map(u => `
        <div class="upgrade ${u.owned >= 50 ? 'bought' : ''}" onclick="buyUpgrade('${u.id}')">
          <div class="upgrade-name">${u.name}</div>
          <div class="upgrade-cost">Cost: ${u.cost.toLocaleString()}</div>
          <div class="upgrade-effect">
            ${u.type === 'gps' ? `+${u.effect} GPS` :
             u.type === 'click' ? `+${u.effect} Click Power` :
             u.type === 'speed' ? `${(u.effect*100)}% Faster Clicks` :
             u.type === 'prestige' ? `+${u.effect} Prestige` :
             u.type === 'multi' ? `${(u.effect*100)}% Global Boost` : ''}
          </div>
          <div class="upgrade-level">Lv.${u.owned}</div>
        </div>
      `).join('');
    }

    function updateDisplay(){
      $('points').textContent = Math.floor(points).toLocaleString();
      $('gps').textContent = `${gps.toFixed(2)} GPS`;
      $('total-goons').textContent = `Total Goons: ${Math.floor(totalGoons).toLocaleString()}`;
      $('prestige').textContent = `PRESTIGE (x${prestige} Multiplier)`;
      $('prestige').disabled = totalGoons < 50000;
    }

    function createParticles(count = 12){
      for(let i=0; i<count; i++){
        const p = document.createElement('div');
        p.style.cssText = `
          position:fixed;left:${Math.random()*100}vw;top:${Math.random()*100}vh;
          width:8px;height:8px;background:#fff;border-radius:50%;pointer-events:none;
          animation:particle 1s ease-out forwards;
        `;
        document.body.appendChild(p);
        setTimeout(() => p.remove(), 1000);
      }
    }

    function screenShake(){
      document.body.style.animation = 'shake 0.3s';
      setTimeout(() => document.body.style.animation = '', 300);
    }

    function showAchievement(text){
      const a = document.createElement('div');
      a.className = 'achievement';
      a.textContent = text;
      document.body.appendChild(a);
      setTimeout(() => a.style.opacity = 1, 100);
      setTimeout(() => { a.style.opacity = 0; setTimeout(() => a.remove(), 500); }, 3000);
    }

    function checkAchievements(){
      if (totalGoons > 1000 && !localStorage.getItem('ach1')) { showAchievement("1,000 TOTAL GOONS!"); localStorage.setItem('ach1','1'); }
      if (gps > 50 && !localStorage.getItem('ach2')) { showAchievement("50 GPS! UNSTOPPABLE!"); localStorage.setItem('ach2','1'); }
      if (prestige > 4 && !localStorage.getItem('ach3')) { showAchievement("PRESTIGE x4! GOON GOD!"); localStorage.setItem('ach3','1'); }
    }

    function saveGame(){
      const save = { points, gps, clickPower, prestige, totalGoons, clickInterval, upgrades: upgrades.map(u => ({...u})), autoClickerActive };
      localStorage.setItem('goonSave', JSON.stringify(save));
    }

    function loadGame(){
      const save = JSON.parse(localStorage.getItem('goonSave') || '{}');
      if (save) {
        points = save.points || 0;
        gps = save.gps || 0;
        clickPower = save.clickPower || 1;
        prestige = save.prestige || 1;
        totalGoons = save.totalGoons || 0;
        clickInterval = save.clickInterval || 1000;
        autoClickerActive = save.autoClickerActive || false;
        save.upgrades?.forEach((su, i) => {
          if (upgrades[i]) Object.assign(upgrades[i], su);
        });
        if (autoClickerActive) startAutoClicker();
      }
    }

    $('prestige').onclick = prestigeReset;

    // === SUBMIT TO LEADERBOARD (Users.json) ===
    async function submitToLeaderboard() {
      if (!currentUser || totalGoons < 100) return;
      try {
        // Fetch current users.json
        const r = await fetch('users.json?' + Date.now());
        const data = await r.json();
        let users = data.users || [];

        // Update or add user
        const existing = users.find(u => u.username === currentUser);
        if (existing) {
          existing.totalGoons = Math.max(existing.totalGoons, totalGoons);
          existing.lastUpdated = new Date().toISOString();
        } else {
          users.push({ username: currentUser, totalGoons, lastUpdated: new Date().toISOString() });
        }

        // POST updated users.json (replace with real backend endpoint like /api/update-users)
        await fetch('users.json', { // Simulate; use real endpoint
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ users })
        });
        console.log('Submitted to leaderboard:', currentUser, totalGoons);
      } catch(e) {
        console.error('Submit failed:', e);
      }
    }

    // === LEADERBOARD (From users.json) ===
    async function fetchLeaderboard(){
      const loading = $('loading'), error = $('error'), board = $('board'), rows = $('rows'), updated = $('updated');
      loading.classList.remove('hidden');
      error.classList.add('hidden');
      board.classList.add('hidden');

      try {
        const r = await fetch('users.json?' + Date.now());
        if (!r.ok) throw new Error('HTTP ' + r.status);
        const data = await r.json();
        let list = data.users || [];
        const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

        // Sort by totalGoons DESC
        const sorted = [...list].sort((a,b) => (b.totalGoons || 0) - (a.totalGoons || 0));

        // Pad to 100
        const padded = Array(100).fill().map((_, i) => sorted[i] || { name: null, totalGoons: 0 });

        rows.innerHTML = padded.map((p, idx) => {
          const rank = idx + 1;
          return `<tr>
            <td class="rank">#${rank}</td>
            <td class="name">
              ${p.name ? `
                <div class="avatar"><img src="https://cdn.discordapp.com/embed/avatars/${Math.floor(Math.random()*6)}.png" alt="${e(p.name)}"></div>
                <div style="font-weight:600;">${e(p.name)}</div>
              ` : `<div class="empty-slot">— Empty Slot —</div>`}
            </td>
            <td class="total-goons">${(p.totalGoons || 0).toLocaleString()}</td>
          </tr>`;
        }).join('');

        updated.textContent = `Last updated: ${time}`;
        loading.classList.add('hidden');
        board.classList.remove('hidden');
      } catch (err) {
        console.error(err);
        loading.classList.add('hidden');
        error.classList.remove('hidden');
      }
    }

    function e(t){
      const d = document.createElement('div');
      d.textContent = t;
      return d.innerHTML;
    }

    // Zoom
    const board = $('board');
    const zoomPercent = $('#zoomPercent');
    let scale = 0.5;
    function updateZoom(){
      board.style.transform = `scale(${scale})`;
      board.style.transformOrigin = 'top left';
      zoomPercent.textContent = `${Math.round(scale*100)}%`;
    }
    $('#zoomIn').onclick = () => { scale = Math.min(scale + 0.1, 2); updateZoom(); };
    $('#zoomOut').onclick = () => { scale = Math.max(scale - 0.1, 0.3); updateZoom(); };
    $('#zoomReset').onclick = () => { scale = 0.5; updateZoom(); };
    updateZoom();
  </script>
</body>
</html>
